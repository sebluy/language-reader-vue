var ge=Object.defineProperty;var te=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var Z=(c,e,t)=>e in c?ge(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,ne=(c,e)=>{for(var t in e||(e={}))fe.call(e,t)&&Z(c,t,e[t]);if(te)for(var t of te(e))he.call(e,t)&&Z(c,t,e[t]);return c};var d=(c,e,t)=>(Z(c,typeof e!="symbol"?e+"":e,t),t);import{d as J,o as y,c as E,u as i,R as me,r as _,a as z,b as W,e as G,w as ae,f as M,g as F,h,t as I,i as A,j as se,F as Y,k as B,l as V,m as we,n as P,p as C,D as ye,q as re,v as ie,s as K,x as de,y as S,z as q,A as Te,B as xe,C as be,E as ve,G as Ee}from"./vendor.55905bae.js";const Le=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};Le();const De=J({setup(c){return(e,t)=>(y(),E(i(me)))}});class Ie{constructor(){d(this,"src");d(this,"startTime");d(this,"endTime");d(this,"paused",!0)}setAudioTimes(e,t){return this.startTime=e,this.endTime=t,this}play(){return this.paused=!1,this}pause(){return this.paused=!0,this}getCurrentTime(){}}const Ae=_(new Ie),k=()=>Ae,Se=["src"],Me={setup(c){const e=z(null),t=k();t.getCurrentTime=()=>e.value.currentTime;let n,s,r;const o=()=>{e.value.paused&&(e.value.play(),t.play(),a())},a=()=>{if(clearTimeout(r),s&&!e.value.paused){let p=s-e.value.currentTime;r=window.setTimeout(()=>{L(),u()},p*1e3)}},u=()=>{n&&(e.value.currentTime=n)},T=()=>{e.value.paused?o():L()},x=()=>{u(),a(),o()},L=()=>{e.value.paused||(e.value.pause(),t.pause(),a())},f=p=>{p.target instanceof HTMLInputElement||p.target instanceof HTMLTextAreaElement||(p.key==="p"?T():p.key==="r"&&x())};return W(()=>{document.addEventListener("keydown",f)}),G(()=>{document.removeEventListener("keydown",f)}),ae(t,()=>{(n!==t.startTime||s!==t.endTime)&&(n=t.startTime,s=t.endTime,u(),a()),e.value.paused!==t.paused&&T()}),(p,g)=>(y(),M("audio",{controls:"",src:i(t).src,ref_key:"audio",ref:e},null,8,Se))}},N=class{constructor(e,t){d(this,"word");d(this,"definition");d(this,"mastery");d(this,"sentenceId");this.word=e,this.sentenceId=t,this.definition="",this.mastery=0}updateMastery(e){return this.mastery|=e,this}hasMastery(e){return this.mastery&e}isDefined(){return this.mastery&N.MASTERY_LEVELS.DEFINED}setDefinition(e){this.definition=e,this.updateMastery(N.MASTERY_LEVELS.DEFINED)}getMasteryPercentage(){let e=0;for(let t=1;t<=N.MASTERY_LEVELS.LISTENING2;t<<=1)t&this.mastery&&(e+=1);return e/Object.keys(N.MASTERY_LEVELS).length}getNewCount(){return this.isDefined()?1:0}};let v=N;d(v,"MASTERY_LEVELS",{DEFINED:1<<0,VOCAB_IN_CONTEXT:1<<1,VOCAB_MATCHING:1<<2,CLOZE:1<<3,LISTENING1:1<<4,LISTENING2:1<<5}),d(v,"FULL_MASTERY",63);class w{}d(w,"READER","Reader"),d(w,"VOCAB_IN_CONTEXT","Vocabulary in Context"),d(w,"VOCAB_MATCHING","Vocabulary Matching"),d(w,"CLOZE","Cloze"),d(w,"LISTENING1","Listening 1"),d(w,"LISTENING2","Listening 2");const Ce={class:"sidebar"},_e={class:"sidebar-group"},ke=["value"],Ne={class:"sidebar-group"},We={class:"sidebar-group"},Pe=J({props:["runtimeData","statistics","masteryCounts"],emits:["updateLanguage","importDatabase","exportDatabase","openFiles","changeActivity"],setup(c,{emit:e}){const t=c;F(()=>console.log("Sidebar will update",t));const n=s=>{if(t.masteryCounts===void 0)return"";const r=t.masteryCounts[s];return r>0?`(${r})`:""};return(s,r)=>(y(),M("div",Ce,[h("div",_e,[h("h3",null,I(t.runtimeData.openTextFile),1),h("h4",null,I(t.runtimeData.openAudioFile),1),A(Me),h("button",{onClick:r[0]||(r[0]=o=>s.$emit("openFiles"))},"Open Files"),h("input",{value:t.runtimeData.language,onChange:r[1]||(r[1]=o=>e("updateLanguage",o.target.value)),placeholder:"Language",type:"text"},null,40,ke)]),h("div",Ne,[h("button",{onClick:r[2]||(r[2]=o=>e("changeActivity",i(w).READER))}," Reader "),h("button",{onClick:r[3]||(r[3]=o=>e("changeActivity",i(w).VOCAB_IN_CONTEXT))}," Vocabulary in Context "+I(n(i(v).MASTERY_LEVELS.VOCAB_IN_CONTEXT)),1),h("button",{onClick:r[4]||(r[4]=o=>e("changeActivity",i(w).VOCAB_MATCHING))}," Vocabulary Matching "+I(n(i(v).MASTERY_LEVELS.VOCAB_MATCHING)),1),h("button",{onClick:r[5]||(r[5]=o=>e("changeActivity",i(w).CLOZE))}," Cloze "+I(n(i(v).MASTERY_LEVELS.CLOZE)),1),h("button",{onClick:r[6]||(r[6]=o=>e("changeActivity",i(w).LISTENING1))}," Listening 1 "+I(n(i(v).MASTERY_LEVELS.LISTENING1)),1),h("button",{onClick:r[7]||(r[7]=o=>e("changeActivity",i(w).LISTENING2))}," Listening 2 "+I(n(i(v).MASTERY_LEVELS.LISTENING2)),1)]),h("div",We,[h("button",{onClick:r[8]||(r[8]=o=>e("exportDatabase"))},"Export Database"),h("button",{onClick:r[9]||(r[9]=o=>e("importDatabase"))},"Import Database")])]))}}),Re={id:"main"},R=J({props:["title","subtitle"],setup(c){return(e,t)=>(y(),M(Y,null,[h("div",Re,[h("h2",null,I(c.title),1),h("h3",null,I(c.subtitle),1),se(e.$slots,"activity")]),se(e.$slots,"sidebar")],64))}});class D{static randomWordsByMastery(e,t){const n=Array.from(e.values()).filter(a=>a.definition!=="");if(n.length<t)return[];const s=n.map(a=>a.mastery);let r=Math.min(...s),o=[];for(;o.length<t;){const a=n.filter(u=>u.mastery===r);D.shuffle(a),o=o.concat(a.slice(0,t-o.length)),r+=1}return o}static cleanWord(e){const t=e.match(/\p{Letter}+/u);return t?t[0].toLowerCase():""}static shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}static randomItem(e){const t=Math.floor(Math.random()*e.length);return e[t]}static createHTML(e){const[t,...n]=e,s=document.createElement(t);for(const r in n){const o=n[r];if(Array.isArray(o))s.append(this.createHTML(o));else if(typeof o=="string"||typeof o=="number"||o instanceof Element)s.append(o);else if(typeof o=="object")for(const a in o)s[a]=o[a]}return s}static isEndChar(e){return e==="..."?!1:e.match(/[.?!]/)!==null}static nextEndPos(e,t){for(;;){const n=e.substring(t,t+1);if(e.substring(t,t+3)==="..."){t+=3;continue}if(n==="")return!1;if(this.isEndChar(n))break;t+=1}for(;;){const n=e.substring(t+1,t+2);if(!this.isEndChar(n))break;t+=1}for(;e.substring(t+1,t+2).match(/[\sâ€œ]/)!==null;)t+=1;return t}static createDraggableItem(e){const t=document.createElement(e.tag);return t.id=e.id,t.classList.add("matching-item"),t.innerText=e.text,t.draggable=!0,t.addEventListener("drop",n=>{n.preventDefault();const s=document.getElementById(n.dataTransfer.getData("text/plain")),r=n.target;if(r.draggable===!1)return;const o=r.innerHTML;r.innerHTML=s.innerHTML,s.innerHTML=o,r.classList.remove("drag-over"),e.onDrop&&e.onDrop(s,r,e)}),t.addEventListener("dragenter",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragover",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragleave",n=>{n.target.classList.remove("drag-over")}),t.addEventListener("dragstart",n=>{n.dataTransfer.setData("text/plain",n.target.id)}),t}static benchmark(e){const t=new Date().getTime();e();const n=new Date().getTime();console.log((n-t)/1e3)}static download(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static upload(){const e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("multiple",""),e.style.display="none",document.body.appendChild(e),new Promise(t=>{e.addEventListener("change",()=>{t(e.files||new FileList),e.remove()}),e.click()})}static async uploadText(){return(await D.upload())[0]}static async openFiles(){const e=await D.upload(),t={};for(let n=0;n<e.length;n++){const s=e[n];s.type==="text/plain"&&(t.text=s),(s.type==="audio/mpeg"||s.type==="audio/x-m4a")&&(t.audio=s)}return t}}const H={props:["sentences","wordMap","selectedWordIndex","selectedSentenceIndex","highlighting","wordOptions"],emits:["selectWord"],setup(c,e){const t=n=>{if(c.wordMap===void 0)return"";let s=c.wordMap.get(n);if(!c.highlighting||!s.isDefined())return{backgroundColor:""};let r=(s.getMasteryPercentage()*120).toString(10);return{backgroundColor:"hsl("+r+",100%,75%)"}};return()=>{let n=0;if(c.sentences===void 0)return B("p");let s=c.sentences.map((r,o)=>{let u=r.getWordsAndSpaces().map(x=>{if(x.trim()==="")return x;let L=D.cleanWord(x);if(L==="")return x;let f=n;n+=1;let p=c.selectedWordIndex===f,g={selected:p},l=x;if(c.wordOptions){const b=c.wordOptions(x,L);b.bold&&(g.bold=!0),b.blank&&(l="__________")}let m={key:f,style:p?"":t(L),class:g,onClick(){e.emit("selectWord",f)}};return B("span",m,l)});const T={selected:c.selectedSentenceIndex===o};return B("span",{key:o,class:T},u)});return B("p",{className:c.highlighting?"highlight":""},s)}}},Oe={id:"props.id"},oe={props:["tag","text","focus","definition","language"],emits:["next","definitionUpdate"],setup(c,{emit:e}){const t=c,n=V(()=>t.tag?t.tag:"input"),s=z(null),r=z(t.definition),o=u=>{u.key==="Tab"&&(u.preventDefault(),u.target.blur(),e("next")),u.stopPropagation()},a=()=>{const u=t.text,T="https://translate.googleapis.com/translate_a/single?client=gtx&sl="+t.language+"&tl=en&dt=t&q="+encodeURI(u);fetch(T).then(x=>x.json()).then(x=>{r.value=x[0].map(([L])=>L).join(""),s.value.focus()})};return W(()=>{t.focus&&s.value.focus()}),(u,T)=>(y(),M("div",Oe,[h("span",null,I(t.text),1),(y(),E(we(i(n)),{ref_key:"definitionInput",ref:s,type:"text",placeholder:"Definition",value:r.value,onInput:T[0]||(T[0]=x=>r.value=x.target.value),onBlur:T[1]||(T[1]=x=>e("definitionUpdate",t.text,r.value)),onKeydown:o},null,8,["value"])),h("button",{onClick:a},"Google Translate")]))}};class $e{constructor(e){d(this,"wordIndex");d(this,"text");this.text=e,this.wordIndex=void 0}nextSentence(){if(this.wordIndex===void 0)return;const e=this.text().sentenceIndexByWordIndex,t=e[this.wordIndex];for(;;)if(this.wordIndex===this.text().words.length-1||(this.wordIndex+=1,e[this.wordIndex]!==t))return}nextWord(){this.wordIndex!==void 0&&this.wordIndex!==this.text().words.length-1&&(this.wordIndex+=1)}selectedWord(){return this.wordIndex===void 0?{}:this.text().words[this.wordIndex]}selectedSentence(){if(this.wordIndex===void 0)return{};const e=this.text().sentenceIndexByWordIndex[this.wordIndex],t=this.text().sentences[e].clean;return this.text().sentenceMap.get(t)}setIndex(e){this.wordIndex=e}getIndex(){return this.wordIndex}}const Fe={class:"sidebar right"},Be={class:"sidebar-group"},Ve={class:"sidebar-group"},Ge={class:"sidebar-group"},Ye={props:["languageText","runtimeData"],emits:["changePageBy"],setup(c,{emit:e}){const t=c,n=k(),s=_({selectedWordCursor:new $e(()=>t.languageText),highlighting:!1,page:t.runtimeData.currentPage,marker:void 0}),r=V(()=>s.selectedWordCursor.selectedWord()),o=V(()=>s.selectedWordCursor.selectedSentence()),a=(...p)=>t.languageText.updateWordDefinition(...p),u=(...p)=>t.languageText.updateSentenceDefinition(...p),T=()=>{const p=t.languageText.sentences,g=t.languageText.sentenceMap;if(p.length===0)return;const l=p[0].clean,m=p[p.length-1].clean,b=g.get(l).startTime,O=g.get(m).endTime;n.setAudioTimes(b,O),n.pause()},x=()=>{t.runtimeData.currentPage!==s.page&&(s.selectedWordCursor.setIndex(void 0),s.page=t.runtimeData.currentPage)},L=()=>{s.marker===void 0?(n.play(),s.marker=0):s.marker+=1;let p=t.languageText.sentences;if(s.marker>0){let m=p[s.marker-1],b=t.languageText.sentenceMap.get(m.clean);t.languageText.updateSentenceTimes(b,null,n.getCurrentTime())}if(s.marker===p.length){n.pause(),s.marker=void 0;return}let g=p[s.marker],l=t.languageText.sentenceMap.get(g.clean);t.languageText.updateSentenceTimes(l,n.getCurrentTime(),null)},f=p=>{p.target instanceof HTMLInputElement||p.target instanceof HTMLTextAreaElement||p.key==="m"&&L()};return W(()=>{document.addEventListener("keydown",f)}),G(()=>{document.removeEventListener("keydown",f)}),F(()=>{x(),T()}),P(()=>{T()}),(p,g)=>(y(),E(R,{title:"Reader",subtitle:"Page "+(t.runtimeData.currentPage+1)},{activity:C(()=>[(y(),E(H,{sentences:t.languageText.sentences,"word-map":t.languageText.wordMap,key:t.runtimeData.currentPage,"selected-word-index":i(s).selectedWordCursor.getIndex(),"selected-sentence-index":i(s).marker,highlighting:i(s).highlighting,onSelectWord:g[0]||(g[0]=l=>i(s).selectedWordCursor.setIndex(l))},null,8,["sentences","word-map","selected-word-index","selected-sentence-index","highlighting"]))]),sidebar:C(()=>[h("div",Fe,[h("div",Be,[(y(),E(oe,{id:"word-definition",key:i(r).word,text:i(r).word,focus:i(s).selectedWordCursor.getIndex()!==void 0,definition:i(r).definition,language:t.runtimeData.language,onDefinitionUpdate:a,onNext:g[1]||(g[1]=l=>i(s).selectedWordCursor.nextWord())},null,8,["text","focus","definition","language"])),(y(),E(oe,{tag:"textarea",id:"sentence-definition",key:i(o).sentence,text:i(o).sentence,definition:i(o).definition,language:t.runtimeData.language,onDefinitionUpdate:u,onNext:g[2]||(g[2]=l=>i(s).selectedWordCursor.nextSentence())},null,8,["text","definition","language"]))]),h("div",Ve,[h("button",{onClick:g[3]||(g[3]=l=>e("changePageBy",-1))},"Previous Page"),h("button",{onClick:g[4]||(g[4]=l=>e("changePageBy",1))},"Next Page")]),h("div",Ge,[h("button",{onClick:g[5]||(g[5]=l=>i(s).highlighting=!i(s).highlighting)}," Toggle Highlighting ")])])]),_:1},8,["subtitle"]))}};class ${constructor(){d(this,"currentPage");d(this,"xpToday");d(this,"xpLast");d(this,"xpDate");d(this,"openAudioFile");d(this,"openTextFile");d(this,"wordsLearnedToday");d(this,"language");this.xpToday=0,this.xpLast=0,this.xpDate=new Date().toLocaleDateString(),this.currentPage=0,this.wordsLearnedToday=0,this.language="es"}static fromObject(e){const t=new $;return Object.assign(t,e),t}updateForNewDay(){this.isNewDay()&&(this.xpLast=this.xpToday,this.xpToday=0,this.xpDate=new Date().toLocaleDateString(),this.wordsLearnedToday=0)}isNewDay(){return this.xpDate!==new Date().toLocaleDateString()}openNewTextFile(e){this.openTextFile=e,this.currentPage=0}openNewAudioFile(e){this.openAudioFile=e}}class ce{constructor(e,t=""){d(this,"id");d(this,"sentence");d(this,"definition");d(this,"mastery");d(this,"startTime");d(this,"endTime");this.sentence=e,this.definition=t,this.mastery=0}getRawWords(){return this.sentence.split(/\s+/).filter(e=>e!=="")}updateTimes(e,t){Number.isNaN(e)||(this.startTime=e),Number.isNaN(t)||(this.endTime=t)}}class He{constructor(){d(this,"db");this.db=new ye("LanguageDB"),this.db.version(2).stores({words:"word, mastery",sentences:"++id, sentence",other:"key"}),this.db.words.mapToClass(v),this.db.sentences.mapToClass(ce)}getWord(e){return this.db.words.get(e)}getSentence(e){return this.db.sentences.where("sentence").equals(e).first()}getSentenceById(e){return this.db.sentences.get(e)}getNumberOfWords(){return this.db.words.count()}putWords(e){return this.db.words.bulkPut(e)}putSentence(e){return console.log("Updating sentence",e),this.db.sentences.put(e)}async import(e){return await this.db.words.clear(),await this.db.sentences.clear(),await this.db.other.delete("runtimeData"),e.words=e.words.map(t=>(t.mastery===5?t.mastery=v.FULL_MASTERY:t.definition!==""?t.mastery=v.MASTERY_LEVELS.DEFINED:t.mastery=0,t)),console.log("importing words"),await this.putWords(e.words),console.log("done importing words"),console.log("importing sentences"),await this.db.sentences.bulkPut(e.sentences),console.log("done importing sentences"),await this.db.other.put({key:"runtimeData",value:e.runtimeData}),console.log("done import"),"done"}async export(){const e=await this.db.words.toArray(),t=await this.db.sentences.toArray();return{runtimeData:await this.getRuntimeData(),sentences:t,words:e}}getRuntimeData(){return this.db.other.get("runtimeData").then(e=>e===void 0?new $:$.fromObject(e.value))}putRuntimeData(e){console.log("Saving runtime data",e),this.db.other.put({key:"runtimeData",value:e})}getTextFile(){return this.db.other.get("textFile").then(e=>e===void 0?void 0:e.value)}putTextFile(e){this.db.other.put({key:"textFile",value:e})}getAudioFile(){return this.db.other.get("audioFile").then(e=>e===void 0?void 0:e.value)}putAudioFile(e){this.db.other.put({key:"audioFile",value:e})}async getSentencesForWords(e){const t=await this.db.sentences.bulkGet(e.map(n=>n.sentenceId));return new Map(t.map(n=>[n.id,n]))}async getPracticeByType(e){const n=(await this.db.words.where("mastery").notEqual(v.FULL_MASTERY).toArray()).filter(s=>s.isDefined()&&!s.hasMastery(e));return D.shuffle(n),n}async getMasteryCounts(){const e=await this.db.words.where("mastery").notEqual(v.FULL_MASTERY).toArray(),t={},n=Object.values(v.MASTERY_LEVELS);return n.forEach(s=>{t[s]=0}),e.forEach(s=>{n.forEach(r=>{s.isDefined()&&!s.hasMastery(r)&&(t[r]+=1)})}),t}async getAllWords(){return await this.db.words.toArray()}async getDefinedSentences(){return(await this.db.sentences.toArray()).filter(e=>e.definition!=="")}}const Ue=new He,le=()=>Ue,Q={props:["sentence"],setup(c){const e=c,t=k(),n=le(),s=_({startTime:e.sentence.startTime,endTime:e.sentence.endTime});ae(e,()=>{s.startTime=e.sentence.startTime,s.endTime=e.sentence.endTime});const r=a=>{if(a!=="")return Number.parseFloat(a)},o=()=>{let a=r(s.startTime),u=r(s.endTime);e.sentence.updateTimes(a,u),t.setAudioTimes(a,u),n.putSentence(K(e.sentence))};return(a,u)=>(y(),M(Y,null,[re(h("input",{ref:"definitionInput",type:"number",placeholder:"Start Time","onUpdate:modelValue":u[0]||(u[0]=T=>i(s).startTime=T),onBlur:o},null,544),[[ie,i(s).startTime]]),re(h("input",{ref:"definitionInput",type:"number",placeholder:"End Time","onUpdate:modelValue":u[1]||(u[1]=T=>i(s).endTime=T),onBlur:o},null,544),[[ie,i(s).endTime]])],64))}},je=["onClick"],U={props:["pool","solution"],emits:["correctAnswer"],setup(c,{emit:e}){const t=c;let n;const s=o=>{o===t.solution&&e("correctAnswer")},r=V(()=>{const o=[t.solution];for(let a=0;a<20;a+=1){let u=D.randomItem(t.pool);if(o.indexOf(u)===-1&&o.push(u),o.length===4)break}return D.shuffle(o),o});return W(()=>{n=o=>{if(!(o.target instanceof HTMLInputElement||o.target instanceof HTMLTextAreaElement)&&["1","2","3","4"].indexOf(o.key)!==-1){o.preventDefault();let u=Number.parseInt(o.key)-1;s(r.value[u])}},document.addEventListener("keydown",n)}),G(()=>{document.removeEventListener("keydown",n)}),(o,a)=>(y(),M("div",null,[(y(!0),M(Y,null,de(i(r),(u,T)=>(y(),M("button",{key:"index",class:"multiple-choice",onClick:x=>s(u)},I(`${T+1}. ${u}`),9,je))),128))]))}};class ue{constructor(e,t,n=void 0){d(this,"raw");d(this,"clean");d(this,"sentenceId");this.raw=e,this.clean=t,this.sentenceId=n}getWords(){return this.clean.split(/\s+/).map(D.cleanWord).filter(e=>e!=="")}getWordsAndSpaces(){return this.raw.split(/(\s+)/)}}class j{constructor(e,t,n){d(this,"masteryLevel");d(this,"practiceWords");d(this,"wordIndex");d(this,"sentences");d(this,"wordPool");d(this,"sentencePool");d(this,"db");d(this,"done");this.masteryLevel=e,this.db=t,this.practiceWords=[],this.wordIndex=0,this.sentences=new Map,this.wordPool=[],this.sentencePool=[],this.done=n}word(){return this.practiceWords[this.wordIndex]}sentence(){const e=this.word();if(e!==void 0)return this.sentences.get(e.sentenceId)}rawSentences(){const e=this.sentence();return e===void 0?[]:[new ue(e.sentence,e.sentence,e.id)]}correctAnswer(){const e=this.word();e.updateMastery(this.masteryLevel),this.db.putWords([K(e)]),this.wordIndex+=1,this.wordIndex===this.practiceWords.length&&this.done()}async load(){const e=await this.db.getPracticeByType(this.masteryLevel),t=await this.db.getSentencesForWords(e),n=await this.db.getAllWords(),s=(await this.db.getDefinedSentences()).map(r=>r.definition);this.practiceWords=e,this.sentences=t,this.wordPool=n,this.sentencePool=s}}const Xe={class:"sidebar right"},Ze={class:"sidebar-group"},qe={props:["db"],emits:["done"],setup(c,{emit:e}){const t=c,n=k(),s=_(new j(v.MASTERY_LEVELS.VOCAB_IN_CONTEXT,t.db,()=>e("done"))),r=(a,u)=>u===s.word().word?{bold:!0}:{},o=()=>s.wordPool.filter(a=>a.isDefined()).map(a=>a.definition);return P(()=>{s.load()}),F(()=>{const a=s.sentence();n.setAudioTimes(a.startTime,a.endTime),n.play()}),(a,u)=>i(s).word()?(y(),E(R,{key:0,title:i(w).VOCAB_IN_CONTEXT},{activity:C(()=>[A(H,{sentences:i(s).rawSentences(),"word-options":r},null,8,["sentences"]),A(U,{pool:o(),solution:i(s).word().definition,onCorrectAnswer:u[0]||(u[0]=()=>i(s).correctAnswer())},null,8,["pool","solution"])]),sidebar:C(()=>[h("div",Xe,[h("div",Ze,[A(Q,{sentence:i(s).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):S("",!0)}},ze={props:["db"],emits:["done"],setup(c,{emit:e}){const t=c,n=_({practiceWords:[],practiceIndex:0,words:[],grid:[]});P(async()=>{n.practiceWords=await t.db.getPracticeByType(v.MASTERY_LEVELS.VOCAB_MATCHING),T()}),W(()=>{document.addEventListener("keydown",L)}),G(()=>{document.removeEventListener("keydown",L)});const s=(f,p)=>{const g=n.grid[p][f];return{"matching-item":!0,selected:g===void 0?!1:g.selected}},r=(f,p)=>{const g=n.grid[p][f];return g===void 0?"":n.words[g.wordIndex].definition},o=f=>{for(let p=0;p<n.words.length;p++)for(let g=0;g<n.words.length;g++){const l=n.grid[p][g];if(l&&f(l))return ne({x:g,y:p},l)}},a=()=>{const f=o(l=>l.selected),p=(f.shuffledIndex+1)%n.words.length,g=o(l=>l.shuffledIndex===p);f.selected=!1,g.selected=!0},u=(f,p)=>{const{x:g,y:l}=o(X=>X.selected),m=g+f,b=l+p;if(!(1<=m&&m<=2&&0<=b&&b<=n.words.length-1))return;const pe=n.grid[b][m];n.grid[b][m]=n.grid[l][g],n.grid[l][g]=pe,x()&&(n.words.forEach(X=>X.updateMastery(v.MASTERY_LEVELS.VOCAB_MATCHING)),this.db.putWords(K(n.words)),T())},T=()=>{n.words=n.practiceWords.slice(n.practiceIndex,n.practiceIndex+8),n.words.length===0&&e("done");const f=n.words.map((p,g)=>g);D.shuffle(f),n.grid=f.map((p,g)=>[void 0,void 0,{wordIndex:p,shuffledIndex:g,selected:g===0}]),n.practiceIndex+=n.words.length},x=()=>{for(let f=0;f<n.words.length;f++){const p=n.grid[f][1];if(p===void 0||p.wordIndex!==f)return!1}return!0},L=f=>{f.key==="Tab"&&(f.preventDefault(),a()),f.key==="ArrowDown"&&(f.preventDefault(),u(0,1)),f.key==="ArrowLeft"&&(f.preventDefault(),u(-1,0)),f.key==="ArrowUp"&&(f.preventDefault(),u(0,-1)),f.key==="ArrowRight"&&(f.preventDefault(),u(1,0)),f.stopPropagation()};return(f,p)=>i(n).practiceWords.length>0?(y(),E(R,{key:0,title:i(w).VOCAB_IN_CONTEXT},{activity:C(()=>[h("table",null,[(y(!0),M(Y,null,de(i(n).words,(g,l)=>(y(),M("tr",null,[h("td",{class:q(s(0,l))},I(g.word),3),h("td",{class:q(s(1,l))},I(r(1,l)),3),h("td",{class:q(s(2,l))},I(r(2,l)),3)]))),256))])]),_:1},8,["title"])):S("",!0)}},Je={props:["db"],emits:["done"],setup(c,{emit:e}){const t=c,n=_(new j(v.MASTERY_LEVELS.CLOZE,t.db,()=>e("done"))),s=(o,a)=>a===n.word().word?{blank:!0}:{},r=()=>n.wordPool.map(o=>o.word);return P(()=>{n.load()}),(o,a)=>i(n).word()?(y(),E(R,{key:0,title:i(w).CLOZE},{activity:C(()=>[A(H,{sentences:i(n).rawSentences(),"word-options":s},null,8,["sentences"]),A(U,{pool:r(),solution:i(n).word().word,onCorrectAnswer:a[0]||(a[0]=()=>i(n).correctAnswer())},null,8,["pool","solution"])]),_:1},8,["title"])):S("",!0)}},Ke={class:"sidebar right"},Qe={class:"sidebar-group"},et={props:["db"],emits:["done"],setup(c,{emit:e}){const t=c,n=k(),s=_(new j(v.MASTERY_LEVELS.LISTENING1,t.db,()=>e("done"))),r=(a,u)=>u===s.word().word?{blank:!0}:{},o=()=>s.wordPool.map(a=>a.word);return P(()=>{s.load()}),F(()=>{const a=s.sentence();n.setAudioTimes(a.startTime,a.endTime),n.play()}),(a,u)=>i(s).word()?(y(),E(R,{key:0,title:i(w).LISTENING1},{activity:C(()=>[A(H,{sentences:i(s).rawSentences(),"word-options":r},null,8,["sentences"]),A(U,{pool:o(),solution:i(s).word().word,onCorrectAnswer:u[0]||(u[0]=()=>i(s).correctAnswer())},null,8,["pool","solution"])]),sidebar:C(()=>[h("div",Ke,[h("div",Qe,[A(Q,{sentence:i(s).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):S("",!0)}},tt={class:"sidebar right"},nt={class:"sidebar-group"},st={props:["db"],emits:["done"],setup(c,{emit:e}){const t=c,n=k(),s=_(new j(v.MASTERY_LEVELS.LISTENING2,t.db,()=>e("done")));return P(()=>{s.load()}),F(()=>{const r=s.sentence();n.setAudioTimes(r.startTime,r.endTime),n.play()}),(r,o)=>i(s).sentence()?(y(),E(R,{key:0,title:i(w).LISTENING2},{activity:C(()=>[A(U,{pool:i(s).sentencePool,solution:i(s).sentence().definition,onCorrectAnswer:o[0]||(o[0]=()=>i(s).correctAnswer())},null,8,["pool","solution"])]),sidebar:C(()=>[h("div",tt,[h("div",nt,[A(Q,{sentence:i(s).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):S("",!0)}};class rt{constructor(e,t,n,s,r){d(this,"filename");d(this,"totalWordsTranslated");d(this,"db");d(this,"pages");d(this,"text");d(this,"sentences");d(this,"sentenceMap");d(this,"sentenceIndexByWordIndex");d(this,"words");d(this,"wordMap");d(this,"promise");d(this,"onNewWordLearned");this.db=e,this.filename=t,this.totalWordsTranslated=0,this.pages=this.extractPages(n),this.onNewWordLearned=r,this.sentences=[],this.sentenceMap=new Map,this.words=[],this.wordMap=new Map,this.sentenceIndexByWordIndex=[],this.promise=new Promise(o=>o()),this.setPage(s)}async load(){await this.loadSentences(),await this.loadWords(),await this.loadTotalWordsTranslated()}onUpdateDefinition(e){}setPage(e){return e<0||e>=this.pages.length?!1:(this.text=this.pages[e],!0)}extractPages(e){const n=[];let s=0,r=0,o=0,a=0;for(;a++,a!==1e3;){if(o=e.indexOf(`
`,r+1),o===-1){n.push(e.substring(s));break}if(o-s>1e3){const u=Math.abs(r-s-1e3),T=Math.abs(o-s-1e3),x=u<T?r:o;n.push(e.substring(s,x)),s=x}r=o}return n}async loadWords(){this.wordMap=new Map,this.words=[],this.sentenceIndexByWordIndex=[];let e=0;for(const t of this.sentences){const n=t.getWords();for(const s of n){let r=this.wordMap.get(s);r===void 0&&(r=await this.db.getWord(s)),r===void 0&&(r=new v(s,t.sentenceId)),r.sentenceId===void 0&&(r.sentenceId=t.sentenceId),this.words.push(r),this.wordMap.set(s,r),this.sentenceIndexByWordIndex.push(e)}await this.db.putWords([...this.wordMap.values()]),e+=1}}async loadTotalWordsTranslated(){this.totalWordsTranslated=await this.db.getNumberOfWords()}updateWordDefinition(e,t){const n=this.wordMap.get(e);n!==void 0&&n.definition!==t&&(n.isDefined()||(this.totalWordsTranslated+=1,this.onNewWordLearned()),n.setDefinition(t),console.log("Updating definition... for "+e+" to "+t),this.db.putWords([n]),this.onUpdateDefinition(e))}updateSentenceDefinition(e,t){const n=this.sentenceMap.get(e);n!==void 0&&n.definition!==t&&(n.definition=t,console.log("Updating definition... for "+e+" to "+t),this.db.putSentence(n))}updateMastery(e){e=e.map(t=>this.words.get(t).nextMastery()),this.db.putWords(e)}updateStats(){let e=0,t=0;this.wordMap.forEach(r=>{e+=r.mastery,t+=r.getNewCount()});const n=0,s=e/(this.wordMap.size*5);return{newWords:t,totalWordsTranslated:this.totalWordsTranslated,percentTranslated:n,percentWordsMastered:s}}async loadSentences(){let e=0;for(this.sentences=[],this.sentenceMap=new Map,this.text===void 0&&(this.text="");;){const t=D.nextEndPos(this.text,e),n=this.text.substring(e,t===!1?void 0:t+1);if(n==="")break;const s=n.trim();if(this.sentences.push(new ue(n,s)),t===!1)break;e=t+1}for(const t of this.sentences){if(this.sentenceMap.has(t.clean))continue;let n=await this.db.getSentence(t.clean);n===void 0&&(n=new ce(t.clean),n.id=await this.db.putSentence(n)),this.sentenceMap.set(t.clean,n),t.sentenceId=n.id}}updateSentenceTimes(e,t,n){t!==null&&(e.startTime=t),n!==null&&(e.endTime=n),this.db.putSentence(e)}updateSentence(e){this.sentenceMap.set(e.sentence,e),this.db.putSentence(e)}getWordMap(e){const t=new Map;return e.forEach(n=>{t.set(n,this.words.get(n))}),t}getWordStrArray(){return Array.from(this.words).map(e=>e[1].word)}getSentenceDefinitionArray(){return Array.from(this.sentenceMap).map(e=>e[1].definition)}getDefinitionArray(){return Array.from(this.words).map(e=>e[1].definition)}leastMasteredWord(e){const t=this.getWordMap(e.getWords());return D.randomWordsByMastery(t,1)[0]}leastMastery(){let e=v.MAX_MASTERY;return Array.from(this.words).forEach(([t,n])=>{n.definition!==""&&n.mastery<e&&(e=n.mastery)}),e}}const it={setup(c){const e=le(),t=Te(void 0),n=k();let s=new $;const r=_({runtimeData:s,masteryCounts:{},activity:w.READER}),o=async()=>{if(s=await e.getRuntimeData(),r.runtimeData=s,r.runtimeData.updateForNewDay(),r.masteryCounts=await e.getMasteryCounts(),console.log(r.runtimeData),r.runtimeData.openTextFile){const l=await e.getTextFile();t.value=await a(l),g()}if(r.runtimeData.openAudioFile){let l=await e.getAudioFile();n.src=URL.createObjectURL(l)}},a=async l=>{let m=new rt(e,r.runtimeData.openTextFile,l,r.runtimeData.currentPage,u);return await m.load(),m},u=()=>{r.runtimeData.wordsLearnedToday+=1,r.runtimeData.xpToday+=1,e.putRuntimeData(s)},T=async()=>{const l=await D.openFiles(),m=l.text,b=l.audio;if(m){const O=await m.text();r.runtimeData.openNewTextFile(m.name),t.value=await a(O),e.putTextFile(O),g()}b&&(r.runtimeData.openNewAudioFile(b.name),n.src=URL.createObjectURL(b),e.putAudioFile(b)),e.putRuntimeData(s)},x=async l=>{let m=r.runtimeData.currentPage+l;!t.value.setPage(m)||(await t.value.load(),r.runtimeData.currentPage=m,e.putRuntimeData(s))},L=l=>{r.runtimeData.language=l,e.putRuntimeData(s)},f=async()=>{const m=await(await D.uploadText()).text();await e.import(JSON.parse(m)),await o()},p=async()=>{let l=await e.export();D.download("language-db.json",JSON.stringify(l))},g=()=>{let l=t.value.updateStats();l.wordsLearnedToday=r.runtimeData.wordsLearnedToday,l.xpToday=r.runtimeData.xpToday,l.xpLast=r.runtimeData.xpLast,r.statistics=l};return W(o),(l,m)=>(y(),M("div",null,[A(Pe,{"runtime-data":i(r).runtimeData,statistics:i(r).statistics,"mastery-counts":i(r).masteryCounts,onOpenFiles:T,onUpdateLanguage:L,onImportDatabase:f,onExportDatabase:p,onChangeActivity:m[0]||(m[0]=b=>i(r).activity=b)},null,8,["runtime-data","statistics","mastery-counts"]),i(r).activity===i(w).READER&&i(t)?(y(),E(Ye,{key:0,"runtime-data":i(r).runtimeData,"language-text":i(t),onChangePageBy:x},null,8,["runtime-data","language-text"])):S("",!0),i(r).activity===i(w).VOCAB_IN_CONTEXT?(y(),E(qe,{key:1,db:i(e),onDone:m[1]||(m[1]=b=>i(r).activity=i(w).READER)},null,8,["db"])):S("",!0),i(r).activity===i(w).VOCAB_MATCHING?(y(),E(ze,{key:2,db:i(e),onDone:m[2]||(m[2]=b=>i(r).activity=i(w).READER)},null,8,["db"])):S("",!0),i(r).activity===i(w).CLOZE?(y(),E(Je,{key:3,db:i(e),onDone:m[3]||(m[3]=b=>i(r).activity=i(w).READER)},null,8,["db"])):S("",!0),i(r).activity===i(w).LISTENING1?(y(),E(et,{key:4,db:i(e),onDone:m[4]||(m[4]=b=>i(r).activity=i(w).READER)},null,8,["db"])):S("",!0),i(r).activity===i(w).LISTENING2?(y(),E(st,{key:5,db:i(e),onDone:m[5]||(m[5]=b=>i(r).activity=i(w).READER)},null,8,["db"])):S("",!0)]))}},ot=xe({history:be("/"),routes:[{path:"/",name:"main",component:it}]}),ee=ve(De);ee.use(Ee());ee.use(ot);ee.mount("#app");
