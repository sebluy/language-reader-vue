var we=Object.defineProperty;var ye=(g,e,t)=>e in g?we(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t;var l=(g,e,t)=>(ye(g,typeof e!="symbol"?e+"":e,t),t);import{d as ne,o as m,c as L,u as o,R as Te,r as M,a as te,b as F,e as X,w as ge,f as _,D as xe,g as N,h as c,t as E,i as S,j as H,k as C,l as de,F as Z,m as U,n as j,p as ve,q as k,s as le,v as ce,x as se,y as fe,z as ee,A as be,B as Ee,C as Le,E as De,G as Ae}from"./vendor.89c2f80a.js";const Ie=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};Ie();const Se=ne({setup(g){return(e,t)=>(m(),L(o(Te)))}});class _e{constructor(){l(this,"src");l(this,"startTime");l(this,"endTime");l(this,"paused",!0)}setAudioTimes(e,t){return this.startTime=e,this.endTime=t,this}play(){return this.paused=!1,this}pause(){return this.paused=!0,this}getCurrentTime(){}}const Ce=M(new _e),W=()=>Ce,Me=["src"],ke={setup(g){const e=te(null),t=W();t.getCurrentTime=()=>e.value.currentTime;let n,s,i;const r=()=>{e.value.paused&&(e.value.play(),t.play(),a())},a=()=>{if(clearTimeout(i),s&&!e.value.paused){let h=s-e.value.currentTime;i=window.setTimeout(()=>{D(),u()},h*1e3)}},u=()=>{n&&(e.value.currentTime=n)},y=()=>{e.value.paused?r():D()},x=()=>{u(),a(),r()},D=()=>{e.value.paused||(e.value.pause(),t.pause(),a())},I=h=>{h.target instanceof HTMLInputElement||h.target instanceof HTMLTextAreaElement||(h.key==="p"?y():h.key==="r"&&x())};return F(()=>{document.addEventListener("keydown",I)}),X(()=>{document.removeEventListener("keydown",I)}),ge(t,()=>{(n!==t.startTime||s!==t.endTime)&&(n=t.startTime,s=t.endTime,u(),a()),e.value.paused!==t.paused&&y()}),(h,T)=>(m(),_("audio",{controls:"",src:o(t).src,ref_key:"audio",ref:e},null,8,Me))}};class he{constructor(e,t=""){l(this,"id");l(this,"sentence");l(this,"definition");l(this,"mastery");l(this,"startTime");l(this,"endTime");this.sentence=e,this.definition=t,this.mastery=0}getRawWords(){return this.sentence.split(/\s+/).filter(e=>e!=="")}updateTimes(e,t){Number.isNaN(e)||(this.startTime=e),Number.isNaN(t)||(this.endTime=t)}}const O=class{constructor(e,t){l(this,"word");l(this,"definition");l(this,"mastery");l(this,"sentenceId");this.word=e,this.sentenceId=t,this.definition="",this.mastery=0}updateMastery(e){return this.mastery|=e,this}hasMastery(e){return this.mastery&e}isDefined(){return this.mastery&O.MASTERY_LEVELS.DEFINED}setDefinition(e){this.definition=e,this.updateMastery(O.MASTERY_LEVELS.DEFINED)}getMasteryPercentage(){let e=0;for(let t=1;t<=O.MASTERY_LEVELS.LISTENING2;t<<=1)t&this.mastery&&(e+=1);return e/Object.keys(O.MASTERY_LEVELS).length}getNewCount(){return this.isDefined()?1:0}};let v=O;l(v,"MASTERY_LEVELS",{DEFINED:1<<0,VOCAB_IN_CONTEXT:1<<1,VOCAB_MATCHING:1<<2,CLOZE:1<<3,LISTENING1:1<<4,LISTENING2:1<<5}),l(v,"FULL_MASTERY",63);class A{static randomWordsByMastery(e,t){const n=Array.from(e.values()).filter(a=>a.definition!=="");if(n.length<t)return[];const s=n.map(a=>a.mastery);let i=Math.min(...s),r=[];for(;r.length<t;){const a=n.filter(u=>u.mastery===i);A.shuffle(a),r=r.concat(a.slice(0,t-r.length)),i+=1}return r}static cleanWord(e){const t=e.match(/\p{Letter}+/u);return t?t[0].toLowerCase():""}static shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}static randomItem(e){const t=Math.floor(Math.random()*e.length);return e[t]}static createHTML(e){const[t,...n]=e,s=document.createElement(t);for(const i in n){const r=n[i];if(Array.isArray(r))s.append(this.createHTML(r));else if(typeof r=="string"||typeof r=="number"||r instanceof Element)s.append(r);else if(typeof r=="object")for(const a in r)s[a]=r[a]}return s}static isEndChar(e){return e==="..."?!1:e.match(/[.?!]/)!==null}static nextEndPos(e,t){for(;;){const n=e.substring(t,t+1);if(e.substring(t,t+3)==="..."){t+=3;continue}if(n==="")return!1;if(this.isEndChar(n))break;t+=1}for(;;){const n=e.substring(t+1,t+2);if(!this.isEndChar(n))break;t+=1}for(;e.substring(t+1,t+2).match(/[\sâ€œ]/)!==null;)t+=1;return t}static createDraggableItem(e){const t=document.createElement(e.tag);return t.id=e.id,t.classList.add("matching-item"),t.innerText=e.text,t.draggable=!0,t.addEventListener("drop",n=>{n.preventDefault();const s=document.getElementById(n.dataTransfer.getData("text/plain")),i=n.target;if(i.draggable===!1)return;const r=i.innerHTML;i.innerHTML=s.innerHTML,s.innerHTML=r,i.classList.remove("drag-over"),e.onDrop&&e.onDrop(s,i,e)}),t.addEventListener("dragenter",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragover",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragleave",n=>{n.target.classList.remove("drag-over")}),t.addEventListener("dragstart",n=>{n.dataTransfer.setData("text/plain",n.target.id)}),t}static benchmark(e){const t=new Date().getTime();e();const n=new Date().getTime();console.log((n-t)/1e3)}static download(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static upload(){const e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("multiple",""),e.style.display="none",document.body.appendChild(e),new Promise(t=>{e.addEventListener("change",()=>{t(e.files||new FileList),e.remove()}),e.click()})}static async uploadText(){return(await A.upload())[0]}static async openFiles(){const e=await A.upload(),t={};for(let n=0;n<e.length;n++){const s=e[n];s.type==="text/plain"&&(t.text=s),(s.type==="audio/mpeg"||s.type==="audio/x-m4a")&&(t.audio=s)}return t}}class G{constructor(){l(this,"currentPage");l(this,"xpToday");l(this,"xpLast");l(this,"xpDate");l(this,"openAudioFile");l(this,"openTextFile");l(this,"wordsLearnedToday");l(this,"language");this.xpToday=0,this.xpLast=0,this.xpDate=new Date().toLocaleDateString(),this.currentPage=0,this.wordsLearnedToday=0,this.language="es"}static fromObject(e){const t=new G;return Object.assign(t,e),t}load(e){Object.assign(this,e)}updateForNewDay(){this.isNewDay()&&(this.xpLast=this.xpToday,this.xpToday=0,this.xpDate=new Date().toLocaleDateString(),this.wordsLearnedToday=0)}isNewDay(){return this.xpDate!==new Date().toLocaleDateString()}openNewTextFile(e){this.openTextFile=e,this.currentPage=0}openNewAudioFile(e){this.openAudioFile=e}}const Ne=new G,q=()=>Ne;class We{constructor(){l(this,"db");this.db=new xe("LanguageDB"),this.db.version(2).stores({words:"word, mastery",sentences:"++id, sentence",other:"key"}),this.db.words.mapToClass(v),this.db.sentences.mapToClass(he)}getWord(e){return this.db.words.get(e)}getSentence(e){return this.db.sentences.where("sentence").equals(e).first()}getSentenceById(e){return this.db.sentences.get(e)}async getNumberOfWordsTranslated(){return(await this.getAllWords()).filter(e=>e.isDefined()).length}putWords(e){return this.db.words.bulkPut(e)}putSentence(e){return console.log("Updating sentence",e),this.db.sentences.put(e)}async import(e){return await this.db.words.clear(),await this.db.sentences.clear(),await this.db.other.delete("runtimeData"),console.log("importing words"),await this.putWords(e.words),console.log("done importing words"),console.log("importing sentences"),await this.db.sentences.bulkPut(e.sentences),console.log("done importing sentences"),await this.db.other.put({key:"runtimeData",value:e.runtimeData}),console.log("done import"),"done"}async export(){const e=await this.db.words.toArray(),t=await this.db.sentences.toArray();return{runtimeData:await this.getRuntimeData(),sentences:t,words:e}}getRuntimeData(){return this.db.other.get("runtimeData").then(e=>e===void 0?new G:G.fromObject(e.value))}putRuntimeData(e){console.log("Saving runtime data",e),this.db.other.put({key:"runtimeData",value:e})}getTextFile(){return this.db.other.get("textFile").then(e=>e===void 0?void 0:e.value)}putTextFile(e){this.db.other.put({key:"textFile",value:e})}getAudioFile(){return this.db.other.get("audioFile").then(e=>e===void 0?void 0:e.value)}putAudioFile(e){this.db.other.put({key:"audioFile",value:e})}async getSentencesForWords(e){const t=await this.db.sentences.bulkGet(e.map(n=>n.sentenceId));return new Map(t.map(n=>[n.id,n]))}async getPracticeByType(e){const n=(await this.db.words.where("mastery").notEqual(v.FULL_MASTERY).toArray()).filter(s=>s.isDefined()&&!s.hasMastery(e));return A.shuffle(n),n}async getMasteryCounts(){const e=await this.db.words.where("mastery").notEqual(v.FULL_MASTERY).toArray(),t={},n=Object.values(v.MASTERY_LEVELS);return n.forEach(s=>{t[s]=0}),e.forEach(s=>{n.forEach(i=>{s.isDefined()&&!s.hasMastery(i)&&(t[i]+=1)})}),t}async getAllWords(){return await this.db.words.toArray()}async getDefinedSentences(){return(await this.db.sentences.toArray()).filter(e=>e.definition!=="")}}const Pe=new We,Y=()=>Pe,Re={key:0,id:"stats-modal"},$e=c("td",null,"Total Words Translated",-1),Oe=c("td",null,"Words Learned Today",-1),Fe=c("td",null,"Today's XP",-1),Be=c("td",null,"Last XP",-1),Ve={emits:["hide"],setup(g,{emit:e}){const t=Y(),n=q(),s=M({totalWordsTranslated:0,wordsLearnedToday:0,xpToday:0,xpLast:0,loading:!0});return N(async()=>{s.totalWordsTranslated=await t.getNumberOfWordsTranslated(),s.wordsLearnedToday=n.wordsLearnedToday,s.xpToday=n.xpToday,s.xpLast=n.xpLast,s.loading=!1}),(i,r)=>o(s).loading?S("",!0):(m(),_("div",Re,[c("table",null,[c("tbody",null,[c("tr",null,[$e,c("td",null,E(o(s).totalWordsTranslated),1)]),c("tr",null,[Oe,c("td",null,E(o(s).wordsLearnedToday),1)]),c("tr",null,[Fe,c("td",null,E(o(s).xpToday),1)]),c("tr",null,[Be,c("td",null,E(o(s).xpLast),1)])])]),c("button",{onClick:r[0]||(r[0]=a=>e("hide"))},"Hide")]))}};class w{}l(w,"READER","Reader"),l(w,"VOCAB_IN_CONTEXT","Vocabulary in Context"),l(w,"VOCAB_MATCHING","Vocabulary Matching"),l(w,"CLOZE","Cloze"),l(w,"LISTENING1","Listening 1"),l(w,"LISTENING2","Listening 2");class Ge{constructor(){l(this,"counts")}setCounts(e){this.counts=e}incrementAll(){Object.values(v.MASTERY_LEVELS).forEach(t=>{t!==v.MASTERY_LEVELS.DEFINED&&(this.counts[t]+=1)})}decrement(e){this.counts[e]-=1}getCount(e){return this.counts&&this.counts[e]}}const He=M(new Ge),re=()=>He,Ye={class:"sidebar"},Ue={class:"sidebar-group"},je=["value"],Xe={class:"sidebar-group"},Ze={class:"sidebar-group"},qe={class:"sidebar-group"},ze=ne({props:["runtimeData"],emits:["updateLanguage","importDatabase","exportDatabase","openFiles","changeActivity"],setup(g,{emit:e}){const t=g,n=re(),s=M({isShowingStatistics:!1});H(()=>console.log("Sidebar will update",t));const i=r=>{const a=n.getCount(r);return a>0?`(${a})`:""};return(r,a)=>(m(),_("div",Ye,[c("div",Ue,[c("h3",null,E(t.runtimeData.openTextFile),1),c("h4",null,E(t.runtimeData.openAudioFile),1),C(ke),c("button",{onClick:a[0]||(a[0]=u=>r.$emit("openFiles"))},"Open Files"),c("input",{value:t.runtimeData.language,onChange:a[1]||(a[1]=u=>e("updateLanguage",u.target.value)),placeholder:"Language",type:"text"},null,40,je)]),c("div",Xe,[c("button",{onClick:a[2]||(a[2]=u=>e("changeActivity",o(w).READER))},"Reader"),c("button",{onClick:a[3]||(a[3]=u=>e("changeActivity",o(w).VOCAB_IN_CONTEXT))}," Vocabulary in Context "+E(i(o(v).MASTERY_LEVELS.VOCAB_IN_CONTEXT)),1),c("button",{onClick:a[4]||(a[4]=u=>e("changeActivity",o(w).VOCAB_MATCHING))}," Vocabulary Matching "+E(i(o(v).MASTERY_LEVELS.VOCAB_MATCHING)),1),c("button",{onClick:a[5]||(a[5]=u=>e("changeActivity",o(w).CLOZE))}," Cloze "+E(i(o(v).MASTERY_LEVELS.CLOZE)),1),c("button",{onClick:a[6]||(a[6]=u=>e("changeActivity",o(w).LISTENING1))}," Listening 1 "+E(i(o(v).MASTERY_LEVELS.LISTENING1)),1),c("button",{onClick:a[7]||(a[7]=u=>e("changeActivity",o(w).LISTENING2))}," Listening 2 "+E(i(o(v).MASTERY_LEVELS.LISTENING2)),1)]),c("div",Ze,[c("button",{onClick:a[8]||(a[8]=u=>o(s).isShowingStatistics=!0)},"Show Statistics"),o(s).isShowingStatistics?(m(),L(Ve,{key:0,onHide:a[9]||(a[9]=u=>o(s).isShowingStatistics=!1)})):S("",!0)]),c("div",qe,[c("button",{onClick:a[10]||(a[10]=u=>e("exportDatabase"))},"Export Database"),c("button",{onClick:a[11]||(a[11]=u=>e("importDatabase"))},"Import Database")])]))}}),Je={id:"main"},B=ne({props:["title","subtitle"],setup(g){return(e,t)=>(m(),_(Z,null,[c("div",Je,[c("h2",null,E(g.title),1),c("h3",null,E(g.subtitle),1),de(e.$slots,"activity")]),de(e.$slots,"sidebar")],64))}}),z={props:["sentences","wordMap","selectedWordIndex","selectedSentenceIndex","highlighting","wordOptions"],emits:["selectWord"],setup(g,e){const t=n=>{if(g.wordMap===void 0)return"";let s=g.wordMap.get(n);if(!g.highlighting||!s.isDefined())return{backgroundColor:""};let i=(s.getMasteryPercentage()*120).toString(10);return{backgroundColor:"hsl("+i+",100%,75%)"}};return()=>{let n=0;if(g.sentences===void 0)return U("p");let s=g.sentences.map((i,r)=>{let u=i.getWordsAndSpaces().map(x=>{if(x.trim()==="")return x;let D=A.cleanWord(x);if(D==="")return x;let I=n;n+=1;let h=g.selectedWordIndex===I,T={selected:h},d=x;if(g.wordOptions){const f=g.wordOptions(x,D);f.bold&&(T.bold=!0),f.blank&&(d="__________")}let p={key:I,style:h?"":t(D),class:T,onClick(){e.emit("selectWord",I)}};return U("span",p,d)});const y={selected:g.selectedSentenceIndex===r};return U("span",{key:r,class:y},u)});return U("p",{className:g.highlighting?"highlight":""},s)}}},Ke={id:"props.id"},ue={props:["tag","text","focus","definition","language"],emits:["next","definitionUpdate"],setup(g,{emit:e}){const t=g,n=j(()=>t.tag?t.tag:"input"),s=te(null),i=te(t.definition),r=u=>{u.key==="Tab"&&(u.preventDefault(),u.target.blur(),e("next")),u.stopPropagation()},a=()=>{const u=t.text,y="https://translate.googleapis.com/translate_a/single?client=gtx&sl="+t.language+"&tl=en&dt=t&q="+encodeURI(u);fetch(y).then(x=>x.json()).then(x=>{i.value=x[0].map(([D])=>D).join(""),s.value.focus()})};return F(()=>{t.focus&&s.value.focus()}),(u,y)=>(m(),_("div",Ke,[c("span",null,E(t.text),1),(m(),L(ve(o(n)),{ref_key:"definitionInput",ref:s,type:"text",placeholder:"Definition",value:i.value,onInput:y[0]||(y[0]=x=>i.value=x.target.value),onBlur:y[1]||(y[1]=x=>e("definitionUpdate",t.text,i.value)),onKeydown:r},null,8,["value"])),c("button",{onClick:a},"Google Translate")]))}};class Qe{constructor(e){l(this,"wordIndex");l(this,"text");this.text=e,this.wordIndex=void 0}nextSentence(){if(this.wordIndex===void 0)return;const e=this.text().sentenceIndexByWordIndex,t=e[this.wordIndex];for(;;)if(this.wordIndex===this.text().words.length-1||(this.wordIndex+=1,e[this.wordIndex]!==t))return}nextWord(){this.wordIndex!==void 0&&this.wordIndex!==this.text().words.length-1&&(this.wordIndex+=1)}selectedWord(){return this.wordIndex===void 0?{}:this.text().words[this.wordIndex]}selectedSentence(){if(this.wordIndex===void 0)return{};const e=this.text().sentenceIndexByWordIndex[this.wordIndex],t=this.text().sentences[e].clean;return this.text().sentenceMap.get(t)}setIndex(e){this.wordIndex=e}getIndex(){return this.wordIndex}}const et={class:"sidebar right"},tt={class:"sidebar-group"},nt={class:"sidebar-group"},st={class:"sidebar-group"},rt={props:["languageText","runtimeData"],emits:["changePageBy"],setup(g,{emit:e}){const t=g,n=W(),s=M({selectedWordCursor:new Qe(()=>t.languageText),highlighting:!1,page:t.runtimeData.currentPage,marker:void 0}),i=j(()=>s.selectedWordCursor.selectedWord()),r=j(()=>s.selectedWordCursor.selectedSentence()),a=(...h)=>t.languageText.updateWordDefinition(...h),u=(...h)=>t.languageText.updateSentenceDefinition(...h),y=()=>{const h=t.languageText.sentences,T=t.languageText.sentenceMap;if(h.length===0)return;const d=h[0].clean,p=h[h.length-1].clean,f=T.get(d).startTime,b=T.get(p).endTime;n.setAudioTimes(f,b),n.pause()},x=()=>{t.runtimeData.currentPage!==s.page&&(s.selectedWordCursor.setIndex(void 0),s.page=t.runtimeData.currentPage)},D=()=>{s.marker===void 0?(n.play(),s.marker=0):s.marker+=1;let h=t.languageText.sentences;if(s.marker>0){let p=h[s.marker-1],f=t.languageText.sentenceMap.get(p.clean);t.languageText.updateSentenceTimes(f,null,n.getCurrentTime())}if(s.marker===h.length){n.pause(),s.marker=void 0;return}let T=h[s.marker],d=t.languageText.sentenceMap.get(T.clean);t.languageText.updateSentenceTimes(d,n.getCurrentTime(),null)},I=h=>{h.target instanceof HTMLInputElement||h.target instanceof HTMLTextAreaElement||h.key==="m"&&D()};return F(()=>{document.addEventListener("keydown",I)}),X(()=>{document.removeEventListener("keydown",I)}),H(()=>{x(),y()}),N(()=>{y()}),(h,T)=>(m(),L(B,{title:"Reader",subtitle:"Page "+(t.runtimeData.currentPage+1)},{activity:k(()=>[(m(),L(z,{sentences:t.languageText.sentences,"word-map":t.languageText.wordMap,key:t.runtimeData.currentPage,"selected-word-index":o(s).selectedWordCursor.getIndex(),"selected-sentence-index":o(s).marker,highlighting:o(s).highlighting,onSelectWord:T[0]||(T[0]=d=>o(s).selectedWordCursor.setIndex(d))},null,8,["sentences","word-map","selected-word-index","selected-sentence-index","highlighting"]))]),sidebar:k(()=>[c("div",et,[c("div",tt,[(m(),L(ue,{id:"word-definition",key:o(i).word,text:o(i).word,focus:o(s).selectedWordCursor.getIndex()!==void 0,definition:o(i).definition,language:t.runtimeData.language,onDefinitionUpdate:a,onNext:T[1]||(T[1]=d=>o(s).selectedWordCursor.nextWord())},null,8,["text","focus","definition","language"])),(m(),L(ue,{tag:"textarea",id:"sentence-definition",key:o(r).sentence,text:o(r).sentence,definition:o(r).definition,language:t.runtimeData.language,onDefinitionUpdate:u,onNext:T[2]||(T[2]=d=>o(s).selectedWordCursor.nextSentence())},null,8,["text","definition","language"]))]),c("div",nt,[c("button",{onClick:T[3]||(T[3]=d=>e("changePageBy",-1))},"Previous Page"),c("button",{onClick:T[4]||(T[4]=d=>e("changePageBy",1))},"Next Page")]),c("div",st,[c("button",{onClick:T[5]||(T[5]=d=>o(s).highlighting=!o(s).highlighting)}," Toggle Highlighting ")])])]),_:1},8,["subtitle"]))}},ie={props:["sentence"],setup(g){const e=g,t=W(),n=Y(),s=M({startTime:e.sentence.startTime,endTime:e.sentence.endTime});ge(e,()=>{s.startTime=e.sentence.startTime,s.endTime=e.sentence.endTime});const i=a=>{if(a!=="")return Number.parseFloat(a)},r=()=>{let a=i(s.startTime),u=i(s.endTime);e.sentence.updateTimes(a,u),t.setAudioTimes(a,u),n.putSentence(se(e.sentence))};return(a,u)=>(m(),_(Z,null,[le(c("input",{ref:"definitionInput",type:"number",placeholder:"Start Time","onUpdate:modelValue":u[0]||(u[0]=y=>o(s).startTime=y),onBlur:r},null,544),[[ce,o(s).startTime]]),le(c("input",{ref:"definitionInput",type:"number",placeholder:"End Time","onUpdate:modelValue":u[1]||(u[1]=y=>o(s).endTime=y),onBlur:r},null,544),[[ce,o(s).endTime]])],64))}},it=["onClick"],J={props:["pool","solution"],emits:["correctAnswer"],setup(g,{emit:e}){const t=g;let n;const s=r=>{r===t.solution&&e("correctAnswer")},i=j(()=>{const r=[t.solution];for(let a=0;a<20;a+=1){let u=A.randomItem(t.pool);if(r.indexOf(u)===-1&&r.push(u),r.length===4)break}return A.shuffle(r),r});return F(()=>{n=r=>{if(!(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)&&["1","2","3","4"].indexOf(r.key)!==-1){r.preventDefault();let u=Number.parseInt(r.key)-1;s(i.value[u])}},document.addEventListener("keydown",n)}),X(()=>{document.removeEventListener("keydown",n)}),(r,a)=>(m(),_("div",null,[(m(!0),_(Z,null,fe(o(i),(u,y)=>(m(),_("button",{key:"index",class:"multiple-choice",onClick:x=>s(u)},E(`${y+1}. ${u}`),9,it))),128))]))}};class me{constructor(e,t,n=void 0){l(this,"raw");l(this,"clean");l(this,"sentenceId");this.raw=e,this.clean=t,this.sentenceId=n}getWords(){return this.clean.split(/\s+/).map(A.cleanWord).filter(e=>e!=="")}getWordsAndSpaces(){return this.raw.split(/(\s+)/)}}const ot=re(),$=Y(),pe=q();class K{constructor(e,t){l(this,"masteryLevel");l(this,"practiceWords");l(this,"wordIndex");l(this,"sentences");l(this,"wordPool");l(this,"sentencePool");l(this,"done");this.masteryLevel=e,this.practiceWords=[],this.wordIndex=0,this.sentences=new Map,this.wordPool=[],this.sentencePool=[],this.done=t}word(){return this.practiceWords[this.wordIndex]}sentence(){const e=this.word();if(e!==void 0)return this.sentences.get(e.sentenceId)}rawSentences(){const e=this.sentence();return e===void 0?[]:[new me(e.sentence,e.sentence,e.id)]}correctAnswer(){const e=this.word();e.updateMastery(this.masteryLevel),$.putWords([se(e)]),pe.xpToday+=1,$.putRuntimeData(pe),ot.decrement(this.masteryLevel),this.wordIndex+=1,this.wordIndex===this.practiceWords.length&&this.done()}async load(){const e=await $.getPracticeByType(this.masteryLevel),t=await $.getSentencesForWords(e),n=await $.getAllWords(),s=(await $.getDefinedSentences()).map(i=>i.definition);this.practiceWords=e,this.sentences=t,this.wordPool=n,this.sentencePool=s}}const at={class:"sidebar right"},dt={class:"sidebar-group"},lt={emits:["done"],setup(g,{emit:e}){const t=W(),n=M(new K(v.MASTERY_LEVELS.VOCAB_IN_CONTEXT,()=>e("done"))),s=(r,a)=>a===n.word().word?{bold:!0}:{},i=()=>n.wordPool.filter(r=>r.isDefined()).map(r=>r.definition);return N(()=>{n.load()}),H(()=>{const r=n.sentence();t.setAudioTimes(r.startTime,r.endTime),t.play()}),(r,a)=>o(n).word()?(m(),L(B,{key:0,title:o(w).VOCAB_IN_CONTEXT},{activity:k(()=>[C(z,{sentences:o(n).rawSentences(),"word-options":s},null,8,["sentences"]),C(J,{pool:i(),solution:o(n).word().definition,onCorrectAnswer:a[0]||(a[0]=()=>o(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:k(()=>[c("div",at,[c("div",dt,[C(ie,{sentence:o(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):S("",!0)}},ct={emits:["done"],setup(g,{emit:e}){const t=Y(),n=q(),s=M({practiceWords:[],practiceIndex:0,words:[],grid:[]});N(async()=>{s.practiceWords=await t.getPracticeByType(v.MASTERY_LEVELS.VOCAB_MATCHING),I()}),F(()=>{document.addEventListener("keydown",T)}),X(()=>{document.removeEventListener("keydown",T)});const i=(d,p)=>s.grid[p][d],r=(d,p,f)=>{s.grid[p][d]=f},a=(d,p)=>{const f=i(d,p);return{"matching-item":!0,selected:f===void 0?!1:f.selected}},u=(d,p)=>{const f=i(d,p);return f===void 0?"":s.words[f.wordIndex].definition},y=d=>{for(let p=0;p<s.words.length;p++)for(let f=0;f<s.words.length;f++){const b=i(f,p);if(b&&d(b))return[f,p]}},x=()=>{const[d,p]=y(V=>V.selected),f=i(d,p),b=(f.shuffledIndex+1)%s.words.length,[P,R]=y(V=>V.shuffledIndex===b),ae=i(P,R);f.selected=!1,ae.selected=!0},D=(d,p)=>{const[f,b]=y(Q=>Q.selected),P=f+d,R=b+p;if(!(1<=P&&P<=2&&0<=R&&R<=s.words.length-1))return;const V=i(P,R);r(P,R,i(f,b)),r(f,b,V),h()&&(s.words.forEach(Q=>Q.updateMastery(v.MASTERY_LEVELS.VOCAB_MATCHING)),t.putWords(s.words.map(se)),n.xpToday+=s.words.length,t.putRuntimeData(n),I())},I=()=>{s.words=s.practiceWords.slice(s.practiceIndex,s.practiceIndex+8),s.words.length===0&&e("done");const d=s.words.map((p,f)=>f);A.shuffle(d),s.grid=d.map((p,f)=>[void 0,void 0,{wordIndex:p,shuffledIndex:f,selected:f===0}]),s.practiceIndex+=s.words.length},h=()=>{for(let d=0;d<s.words.length;d++){const p=i(1,d);if(p===void 0||p.wordIndex!==d)return!1}return!0},T=d=>{d.key==="Tab"&&(d.preventDefault(),x()),d.key==="ArrowDown"&&(d.preventDefault(),D(0,1)),d.key==="ArrowLeft"&&(d.preventDefault(),D(-1,0)),d.key==="ArrowUp"&&(d.preventDefault(),D(0,-1)),d.key==="ArrowRight"&&(d.preventDefault(),D(1,0)),d.stopPropagation()};return(d,p)=>o(s).practiceWords.length>0?(m(),L(B,{key:0,title:o(w).VOCAB_IN_CONTEXT},{activity:k(()=>[c("table",null,[(m(!0),_(Z,null,fe(o(s).words,(f,b)=>(m(),_("tr",null,[c("td",{class:ee(a(0,b))},E(f.word),3),c("td",{class:ee(a(1,b))},E(u(1,b)),3),c("td",{class:ee(a(2,b))},E(u(2,b)),3)]))),256))])]),_:1},8,["title"])):S("",!0)}},ut={emits:["done"],setup(g,{emit:e}){const t=M(new K(v.MASTERY_LEVELS.CLOZE,()=>e("done"))),n=(i,r)=>r===t.word().word?{blank:!0}:{},s=()=>t.wordPool.map(i=>i.word);return N(()=>{t.load()}),(i,r)=>o(t).word()?(m(),L(B,{key:0,title:o(w).CLOZE},{activity:k(()=>[C(z,{sentences:o(t).rawSentences(),"word-options":n},null,8,["sentences"]),C(J,{pool:s(),solution:o(t).word().word,onCorrectAnswer:r[0]||(r[0]=()=>o(t).correctAnswer())},null,8,["pool","solution"])]),_:1},8,["title"])):S("",!0)}},pt={class:"sidebar right"},gt={class:"sidebar-group"},ft={emits:["done"],setup(g,{emit:e}){const t=W(),n=M(new K(v.MASTERY_LEVELS.LISTENING1,()=>e("done"))),s=(r,a)=>a===n.word().word?{blank:!0}:{},i=()=>n.wordPool.map(r=>r.word);return N(()=>{n.load()}),H(()=>{const r=n.sentence();t.setAudioTimes(r.startTime,r.endTime),t.play()}),(r,a)=>o(n).word()?(m(),L(B,{key:0,title:o(w).LISTENING1},{activity:k(()=>[C(z,{sentences:o(n).rawSentences(),"word-options":s},null,8,["sentences"]),C(J,{pool:i(),solution:o(n).word().word,onCorrectAnswer:a[0]||(a[0]=()=>o(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:k(()=>[c("div",pt,[c("div",gt,[C(ie,{sentence:o(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):S("",!0)}},ht={class:"sidebar right"},mt={class:"sidebar-group"},wt={emits:["done"],setup(g,{emit:e}){const t=W(),n=M(new K(v.MASTERY_LEVELS.LISTENING2,()=>e("done")));return N(()=>{n.load()}),H(()=>{const s=n.sentence();t.setAudioTimes(s.startTime,s.endTime),t.play()}),(s,i)=>o(n).sentence()?(m(),L(B,{key:0,title:o(w).LISTENING2},{activity:k(()=>[C(J,{pool:o(n).sentencePool,solution:o(n).sentence().definition,onCorrectAnswer:i[0]||(i[0]=()=>o(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:k(()=>[c("div",ht,[c("div",mt,[C(ie,{sentence:o(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):S("",!0)}};class yt{constructor(e,t,n,s,i){l(this,"filename");l(this,"totalWordsTranslated");l(this,"db");l(this,"pages");l(this,"text");l(this,"sentences");l(this,"sentenceMap");l(this,"sentenceIndexByWordIndex");l(this,"words");l(this,"wordMap");l(this,"promise");l(this,"onNewWordLearned");this.db=e,this.filename=t,this.totalWordsTranslated=0,this.pages=this.extractPages(n),this.onNewWordLearned=i,this.sentences=[],this.sentenceMap=new Map,this.words=[],this.wordMap=new Map,this.sentenceIndexByWordIndex=[],this.promise=new Promise(r=>r()),this.setPage(s)}async load(){await this.loadSentences(),await this.loadWords()}onUpdateDefinition(e){}setPage(e){return e<0||e>=this.pages.length?!1:(this.text=this.pages[e],!0)}extractPages(e){const n=[];let s=0,i=0,r=0,a=0;for(;a++,a!==1e3;){if(r=e.indexOf(`
`,i+1),r===-1){n.push(e.substring(s));break}if(r-s>1e3){const u=Math.abs(i-s-1e3),y=Math.abs(r-s-1e3),x=u<y?i:r;n.push(e.substring(s,x)),s=x}i=r}return n}async loadWords(){this.wordMap=new Map,this.words=[],this.sentenceIndexByWordIndex=[];let e=0;for(const t of this.sentences){const n=t.getWords();for(const s of n){let i=this.wordMap.get(s);i===void 0&&(i=await this.db.getWord(s)),i===void 0&&(i=new v(s,t.sentenceId)),i.sentenceId===void 0&&(i.sentenceId=t.sentenceId),this.words.push(i),this.wordMap.set(s,i),this.sentenceIndexByWordIndex.push(e)}await this.db.putWords([...this.wordMap.values()]),e+=1}}updateWordDefinition(e,t){const n=this.wordMap.get(e);n!==void 0&&n.definition!==t&&(n.isDefined()||(this.totalWordsTranslated+=1,this.onNewWordLearned()),n.setDefinition(t),console.log("Updating definition... for "+e+" to "+t),this.db.putWords([n]),this.onUpdateDefinition(e))}updateSentenceDefinition(e,t){const n=this.sentenceMap.get(e);n!==void 0&&n.definition!==t&&(n.definition=t,console.log("Updating definition... for "+e+" to "+t),this.db.putSentence(n))}updateMastery(e){e=e.map(t=>this.words.get(t).nextMastery()),this.db.putWords(e)}async loadSentences(){let e=0;for(this.sentences=[],this.sentenceMap=new Map,this.text===void 0&&(this.text="");;){const t=A.nextEndPos(this.text,e),n=this.text.substring(e,t===!1?void 0:t+1);if(n==="")break;const s=n.trim();if(this.sentences.push(new me(n,s)),t===!1)break;e=t+1}for(const t of this.sentences){if(this.sentenceMap.has(t.clean))continue;let n=await this.db.getSentence(t.clean);n===void 0&&(n=new he(t.clean),n.id=await this.db.putSentence(n)),this.sentenceMap.set(t.clean,n),t.sentenceId=n.id}}updateSentenceTimes(e,t,n){t!==null&&(e.startTime=t),n!==null&&(e.endTime=n),this.db.putSentence(e)}updateSentence(e){this.sentenceMap.set(e.sentence,e),this.db.putSentence(e)}getWordMap(e){const t=new Map;return e.forEach(n=>{t.set(n,this.words.get(n))}),t}getWordStrArray(){return Array.from(this.words).map(e=>e[1].word)}getSentenceDefinitionArray(){return Array.from(this.sentenceMap).map(e=>e[1].definition)}getDefinitionArray(){return Array.from(this.words).map(e=>e[1].definition)}leastMasteredWord(e){const t=this.getWordMap(e.getWords());return A.randomWordsByMastery(t,1)[0]}leastMastery(){let e=v.MAX_MASTERY;return Array.from(this.words).forEach(([t,n])=>{n.definition!==""&&n.mastery<e&&(e=n.mastery)}),e}}const Tt={setup(g){const e=Y(),t=be(void 0),n=W(),s=re(),i=q(),r=M({runtimeData:i,activity:w.READER}),a=async()=>{if(i.load(await e.getRuntimeData()),r.runtimeData=i,r.runtimeData.updateForNewDay(),s.setCounts(await e.getMasteryCounts()),console.log(r.runtimeData),r.runtimeData.openTextFile){const d=await e.getTextFile();t.value=await u(d)}if(r.runtimeData.openAudioFile){let d=await e.getAudioFile();n.src=URL.createObjectURL(d)}},u=async d=>{let p=new yt(e,r.runtimeData.openTextFile,d,r.runtimeData.currentPage,y);return await p.load(),p},y=()=>{r.runtimeData.wordsLearnedToday+=1,r.runtimeData.xpToday+=1,s.incrementAll(),e.putRuntimeData(i)},x=async()=>{const d=await A.openFiles(),p=d.text,f=d.audio;if(p){const b=await p.text();r.runtimeData.openNewTextFile(p.name),t.value=await u(b),e.putTextFile(b)}f&&(r.runtimeData.openNewAudioFile(f.name),n.src=URL.createObjectURL(f),e.putAudioFile(f)),e.putRuntimeData(i)},D=async d=>{let p=r.runtimeData.currentPage+d;!t.value.setPage(p)||(await t.value.load(),r.runtimeData.currentPage=p,e.putRuntimeData(i))},I=d=>{r.runtimeData.language=d,e.putRuntimeData(i)},h=async()=>{const p=await(await A.uploadText()).text();await e.import(JSON.parse(p)),await a()},T=async()=>{let d=await e.export();A.download("language-db.json",JSON.stringify(d))};return F(a),(d,p)=>(m(),_("div",null,[C(ze,{"runtime-data":o(r).runtimeData,onOpenFiles:x,onUpdateLanguage:I,onImportDatabase:h,onExportDatabase:T,onChangeActivity:p[0]||(p[0]=f=>o(r).activity=f)},null,8,["runtime-data"]),o(r).activity===o(w).READER&&o(t)?(m(),L(rt,{key:0,"runtime-data":o(r).runtimeData,"language-text":o(t),onChangePageBy:D},null,8,["runtime-data","language-text"])):S("",!0),o(r).activity===o(w).VOCAB_IN_CONTEXT?(m(),L(lt,{key:1,onDone:p[1]||(p[1]=f=>o(r).activity=o(w).READER)})):S("",!0),o(r).activity===o(w).VOCAB_MATCHING?(m(),L(ct,{key:2,onDone:p[2]||(p[2]=f=>o(r).activity=o(w).READER)})):S("",!0),o(r).activity===o(w).CLOZE?(m(),L(ut,{key:3,onDone:p[3]||(p[3]=f=>o(r).activity=o(w).READER)})):S("",!0),o(r).activity===o(w).LISTENING1?(m(),L(ft,{key:4,onDone:p[4]||(p[4]=f=>o(r).activity=o(w).READER)})):S("",!0),o(r).activity===o(w).LISTENING2?(m(),L(wt,{key:5,onDone:p[5]||(p[5]=f=>o(r).activity=o(w).READER)})):S("",!0)]))}},xt=Ee({history:Le("/language-reader-vue/"),routes:[{path:"/",name:"main",component:Tt}]}),oe=De(Se);oe.use(Ae());oe.use(xt);oe.mount("#app");
