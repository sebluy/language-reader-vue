var xe=Object.defineProperty;var Ee=(p,e,t)=>e in p?xe(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var c=(p,e,t)=>(Ee(p,typeof e!="symbol"?e+"":e,t),t);import{d as re,o as y,c as L,u as a,R as be,r as k,a as Z,b as V,e as z,w as me,f as M,D as Le,C as ce,g as De,h as R,i as Se,j as l,t as b,k as I,l as U,m as C,n as ue,F as J,p as X,q,s as Ae,v as N,x as pe,y as ge,z as ie,A as ye,B as ne,E as _e,G as Ie,H as Me,I as Ce,J as ke}from"./vendor.8e168bff.js";const Ne=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};Ne();const We=re({setup(p){return(e,t)=>(y(),L(a(be)))}});class Re{constructor(){c(this,"src");c(this,"startTime");c(this,"endTime");c(this,"paused",!0)}setAudioTimes(e,t){return this.startTime=e,this.endTime=t,this}play(){return this.paused=!1,this}pause(){return this.paused=!0,this}getCurrentTime(){}}const Pe=k(new Re),P=()=>Pe,$e=["src"],Oe={setup(p){const e=Z(null),t=P();t.getCurrentTime=()=>e.value.currentTime;let n,s,r;const i=()=>{e.value.paused&&(e.value.play(),t.play(),o())},o=()=>{if(clearTimeout(r),s&&!e.value.paused){let f=s-e.value.currentTime;r=window.setTimeout(()=>{_(),u()},f*1e3)}},u=()=>{n&&(e.value.currentTime=n)},T=()=>{e.value.paused?i():_()},v=()=>{u(),o(),i()},_=()=>{e.value.paused||(e.value.pause(),t.pause(),o())},D=f=>{f.target instanceof HTMLInputElement||f.target instanceof HTMLTextAreaElement||(f.key==="p"?T():f.key==="r"&&v())};return V(()=>{document.addEventListener("keydown",D)}),z(()=>{document.removeEventListener("keydown",D)}),me(t,()=>{(n!==t.startTime||s!==t.endTime)&&(n=t.startTime,s=t.endTime,u(),o()),e.value.paused!==t.paused&&T()}),(f,x)=>(y(),M("audio",{controls:"",src:a(t).src,ref_key:"audio",ref:e},null,8,$e))}};class we{constructor(e,t=""){c(this,"id");c(this,"sentence");c(this,"definition");c(this,"mastery");c(this,"startTime");c(this,"endTime");this.sentence=e,this.definition=t,this.mastery=0}getRawWords(){return this.sentence.split(/\s+/).filter(e=>e!=="")}updateTimes(e,t){Number.isNaN(e)||(this.startTime=e),Number.isNaN(t)||(this.endTime=t)}}const W=class{constructor(e,t){c(this,"word");c(this,"definition");c(this,"mastery");c(this,"sentenceId");this.word=e,this.sentenceId=t,this.definition="",this.mastery=0}updateMastery(e){return this.mastery|=e,this}hasMastery(e){return this.mastery&e}isDefined(){return this.mastery&W.MASTERY_LEVELS.DEFINED}isMastered(){return this.mastery===W.FULL_MASTERY}setDefinition(e){this.definition=e,this.updateMastery(W.MASTERY_LEVELS.DEFINED)}getMasteryPercentage(){let e=0;for(let t=1;t<=W.MASTERY_LEVELS.LISTENING2;t<<=1)t&this.mastery&&(e+=1);return e/W.MASTERY_LEVEL_COUNT}getNewCount(){return this.isDefined()?1:0}};let E=W;c(E,"MASTERY_LEVELS",{DEFINED:1<<0,VOCAB_IN_CONTEXT:1<<1,VOCAB_MATCHING:1<<2,CLOZE:1<<3,LISTENING1:1<<4,LISTENING2:1<<5}),c(E,"MASTERY_LEVEL_COUNT",6),c(E,"FULL_MASTERY",63);class A{static randomWordsByMastery(e,t){const n=Array.from(e.values()).filter(o=>o.definition!=="");if(n.length<t)return[];const s=n.map(o=>o.mastery);let r=Math.min(...s),i=[];for(;i.length<t;){const o=n.filter(u=>u.mastery===r);A.shuffle(o),i=i.concat(o.slice(0,t-i.length)),r+=1}return i}static cleanWord(e){const t=e.match(/\p{Letter}+/u);return t?t[0].toLowerCase():""}static shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}static randomItem(e){const t=Math.floor(Math.random()*e.length);return e[t]}static createHTML(e){const[t,...n]=e,s=document.createElement(t);for(const r in n){const i=n[r];if(Array.isArray(i))s.append(this.createHTML(i));else if(typeof i=="string"||typeof i=="number"||i instanceof Element)s.append(i);else if(typeof i=="object")for(const o in i)s[o]=i[o]}return s}static isEndChar(e){return e==="..."?!1:e.match(/[.?!]/)!==null}static nextEndPos(e,t){for(;;){const n=e.substring(t,t+1);if(e.substring(t,t+3)==="..."){t+=3;continue}if(n==="")return!1;if(this.isEndChar(n))break;t+=1}for(;;){const n=e.substring(t+1,t+2);if(!this.isEndChar(n))break;t+=1}for(;e.substring(t+1,t+2).match(/[\sâ€œ]/)!==null;)t+=1;return t}static createDraggableItem(e){const t=document.createElement(e.tag);return t.id=e.id,t.classList.add("matching-item"),t.innerText=e.text,t.draggable=!0,t.addEventListener("drop",n=>{n.preventDefault();const s=document.getElementById(n.dataTransfer.getData("text/plain")),r=n.target;if(r.draggable===!1)return;const i=r.innerHTML;r.innerHTML=s.innerHTML,s.innerHTML=i,r.classList.remove("drag-over"),e.onDrop&&e.onDrop(s,r,e)}),t.addEventListener("dragenter",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragover",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragleave",n=>{n.target.classList.remove("drag-over")}),t.addEventListener("dragstart",n=>{n.dataTransfer.setData("text/plain",n.target.id)}),t}static benchmark(e){const t=new Date().getTime();e();const n=new Date().getTime();console.log((n-t)/1e3)}static download(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static upload(){const e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("multiple",""),e.style.display="none",document.body.appendChild(e),new Promise(t=>{e.addEventListener("change",()=>{t(e.files||new FileList),e.remove()}),e.click()})}static async uploadText(){return(await A.upload())[0]}static async openFiles(){const e=await A.upload(),t={};for(let n=0;n<e.length;n++){const s=e[n];s.type==="text/plain"&&(t.text=s),(s.type==="audio/mpeg"||s.type==="audio/x-m4a")&&(t.audio=s)}return t}}class Y{constructor(){c(this,"currentPage");c(this,"openAudioFile");c(this,"openTextFile");c(this,"date");c(this,"definedToday");c(this,"learnedToday");c(this,"masteredToday");c(this,"language");this.date=new Date().toLocaleDateString(),this.currentPage=0,this.definedToday=0,this.learnedToday=0,this.masteredToday=0,this.language="es"}static fromObject(e){const t=new Y;return Object.assign(t,e),t}load(e){Object.assign(this,e)}updateForNewDay(){this.date=new Date().toLocaleDateString()}isNewDay(){return this.date!==new Date().toLocaleDateString()}openNewTextFile(e){this.openTextFile=e,this.currentPage=0}openNewAudioFile(e){this.openAudioFile=e}}const Fe=new Y,ae=()=>Fe;class he{constructor(e,t,n,s){c(this,"date");c(this,"defined");c(this,"learned");c(this,"mastered");this.date=e,this.defined=t,this.learned=n,this.mastered=s}}class Ve{constructor(){c(this,"db");this.db=new Le("LanguageDB"),this.db.version(3).stores({words:"word, mastery",sentences:"++id, sentence",history:"date",other:"key"}),this.db.words.mapToClass(E),this.db.sentences.mapToClass(we),this.db.history.mapToClass(he)}getWord(e){return this.db.words.get(e)}getSentence(e){return this.db.sentences.where("sentence").equals(e).first()}getSentenceById(e){return this.db.sentences.get(e)}putWords(e){return this.db.words.bulkPut(e)}putSentence(e){return console.log("Updating sentence",e),this.db.sentences.put(e)}async import(e){return await this.db.words.clear(),await this.db.sentences.clear(),await this.db.history.clear(),await this.db.other.delete("runtimeData"),console.log("importing words"),await this.putWords(e.words),console.log("done importing words"),console.log("importing sentences"),await this.db.sentences.bulkPut(e.sentences),console.log("done importing sentences"),await this.db.history.bulkPut(e.history),await this.db.other.put({key:"runtimeData",value:e.runtimeData}),console.log("done import"),"done"}async export(){const e=await this.db.words.toArray(),t=await this.db.sentences.toArray(),n=await this.getRuntimeData(),s=await this.getHistory();return{runtimeData:n,sentences:t,words:e,history:s}}getRuntimeData(){return this.db.other.get("runtimeData").then(e=>e===void 0?new Y:Y.fromObject(e.value))}putRuntimeData(e){console.log("Saving runtime data",e),this.db.other.put({key:"runtimeData",value:e})}getTextFile(){return this.db.other.get("textFile").then(e=>e===void 0?void 0:e.value)}putTextFile(e){this.db.other.put({key:"textFile",value:e})}getAudioFile(){return this.db.other.get("audioFile").then(e=>e===void 0?void 0:e.value)}putAudioFile(e){this.db.other.put({key:"audioFile",value:e})}async getSentencesForWords(e){const t=await this.db.sentences.bulkGet(e.map(n=>n.sentenceId));return new Map(t.map(n=>[n.id,n]))}async getPracticeByType(e){const n=(await this.db.words.where("mastery").notEqual(E.FULL_MASTERY).toArray()).filter(s=>s.isDefined()&&!s.hasMastery(e));return A.shuffle(n),n}async getMasteryCounts(){const e=await this.db.words.where("mastery").notEqual(E.FULL_MASTERY).toArray(),t={},n=Object.values(E.MASTERY_LEVELS);return n.forEach(s=>{t[s]=0}),e.forEach(s=>{n.forEach(r=>{s.isDefined()&&!s.hasMastery(r)&&(t[r]+=1)})}),t}async getAllWords(){return await this.db.words.toArray()}async getDefinedSentences(){return(await this.db.sentences.toArray()).filter(e=>e.definition!=="")}async getHistory(){return(await this.db.history.toArray()).sort((e,t)=>{const n=new Date(e.date),s=new Date(t.date);return n.getTime()-s.getTime()})}async putHistoryDay(e){return this.db.history.put(e)}async getStatistics(e=void 0){const t=await Te.getAllWords();e===void 0&&(e=new Date().toLocaleDateString());const n=new he(e,0,0,0);return t.forEach(s=>{s.isDefined()&&(n.defined+=1),s.isMastered()&&(n.mastered+=1),n.learned+=s.getMasteryPercentage()}),n}async getLastStatistics(){return this.db.history.toCollection().last()}}const Te=new Ve,G=()=>Te,Be={key:0,id:"stats-modal"},He=l("td",null,"Words Defined",-1),Ye=l("td",null,"Words Learned",-1),Ue=l("td",null,"Words Mastered",-1),Ge=l("td",null,"Defined Today",-1),je=l("td",null,"Learned Today",-1),Xe=l("td",null,"Mastered Today",-1),Ze={emits:["hide"],setup(p,{emit:e}){ce.register(...De);const t=Z(null),n=G(),s=k({history:[],defined:0,learned:0,mastered:0,definedToday:0,learnedToday:0,masteredToday:0,loading:!0});return R(async()=>{const r=await n.getStatistics();s.history=await n.getHistory();const i=s.history[s.history.length-1];s.history.push(r),s.defined=r.defined,s.learned=r.learned,s.mastered=r.mastered,i===void 0?(s.definedToday=r.defined,s.learnedToday=r.learned,s.masteredToday=r.mastered):(s.definedToday=r.defined-i.defined,s.learnedToday=r.learned-i.learned,s.masteredToday=r.mastered-i.mastered),s.loading=!1}),Se(()=>{!t.value||new ce(t.value,{type:"line",data:{labels:s.history.map(r=>r.date),datasets:[{label:"Learned",data:s.history.map(r=>r.learned)}]},options:{scales:{y:{beginAtZero:!0}}}})}),(r,i)=>a(s).loading?I("",!0):(y(),M("div",Be,[l("div",null,[l("table",null,[l("tbody",null,[l("tr",null,[He,l("td",null,b(a(s).defined),1)]),l("tr",null,[Ye,l("td",null,b(a(s).learned.toFixed(2)),1)]),l("tr",null,[Ue,l("td",null,b(a(s).mastered),1)]),l("tr",null,[Ge,l("td",null,b(a(s).definedToday),1)]),l("tr",null,[je,l("td",null,b(a(s).learnedToday.toFixed(2)),1)]),l("tr",null,[Xe,l("td",null,b(a(s).masteredToday),1)])])])]),l("div",null,[l("canvas",{ref_key:"chart",ref:t,width:"400",height:"200"},null,512)]),l("button",{onClick:i[0]||(i[0]=o=>e("hide"))},"Hide")]))}};class w{}c(w,"READER","Reader"),c(w,"VOCAB_IN_CONTEXT","Vocabulary in Context"),c(w,"VOCAB_MATCHING","Vocabulary Matching"),c(w,"CLOZE","Cloze"),c(w,"LISTENING1","Listening 1"),c(w,"LISTENING2","Listening 2");class qe{constructor(){c(this,"counts")}setCounts(e){this.counts=e}incrementAll(){Object.values(E.MASTERY_LEVELS).forEach(t=>{t!==E.MASTERY_LEVELS.DEFINED&&(this.counts[t]+=1)})}decrement(e){this.counts[e]-=1}getCount(e){return this.counts&&this.counts[e]}}const ze=k(new qe),K=()=>ze,Je={class:"sidebar"},Ke={class:"sidebar-group"},Qe=["value"],et={class:"sidebar-group"},tt={class:"sidebar-group"},nt={class:"sidebar-group"},st=re({props:["runtimeData"],emits:["updateLanguage","importDatabase","exportDatabase","openFiles","changeActivity"],setup(p,{emit:e}){const t=p,n=K(),s=k({isShowingStatistics:!1});U(()=>console.log("Sidebar will update",t));const r=i=>{const o=n.getCount(i);return o>0?`(${o})`:""};return(i,o)=>(y(),M("div",Je,[l("div",Ke,[l("h3",null,b(t.runtimeData.openTextFile),1),l("h4",null,b(t.runtimeData.openAudioFile),1),C(Oe),l("button",{onClick:o[0]||(o[0]=u=>i.$emit("openFiles"))},"Open Files"),l("input",{value:t.runtimeData.language,onChange:o[1]||(o[1]=u=>e("updateLanguage",u.target.value)),placeholder:"Language",type:"text"},null,40,Qe)]),l("div",et,[l("button",{onClick:o[2]||(o[2]=u=>e("changeActivity",a(w).READER))},"Reader"),l("button",{onClick:o[3]||(o[3]=u=>e("changeActivity",a(w).VOCAB_IN_CONTEXT))}," Vocabulary in Context "+b(r(a(E).MASTERY_LEVELS.VOCAB_IN_CONTEXT)),1),l("button",{onClick:o[4]||(o[4]=u=>e("changeActivity",a(w).VOCAB_MATCHING))}," Vocabulary Matching "+b(r(a(E).MASTERY_LEVELS.VOCAB_MATCHING)),1),l("button",{onClick:o[5]||(o[5]=u=>e("changeActivity",a(w).CLOZE))}," Cloze "+b(r(a(E).MASTERY_LEVELS.CLOZE)),1),l("button",{onClick:o[6]||(o[6]=u=>e("changeActivity",a(w).LISTENING1))}," Listening 1 "+b(r(a(E).MASTERY_LEVELS.LISTENING1)),1),l("button",{onClick:o[7]||(o[7]=u=>e("changeActivity",a(w).LISTENING2))}," Listening 2 "+b(r(a(E).MASTERY_LEVELS.LISTENING2)),1)]),l("div",tt,[l("button",{onClick:o[8]||(o[8]=u=>a(s).isShowingStatistics=!0)},"Show Statistics"),a(s).isShowingStatistics?(y(),L(Ze,{key:0,onHide:o[9]||(o[9]=u=>a(s).isShowingStatistics=!1)})):I("",!0)]),l("div",nt,[l("button",{onClick:o[10]||(o[10]=u=>e("exportDatabase"))},"Export Database"),l("button",{onClick:o[11]||(o[11]=u=>e("importDatabase"))},"Import Database")])]))}}),rt={id:"main"},B=re({props:["title","subtitle"],setup(p){return(e,t)=>(y(),M(J,null,[l("div",rt,[l("h2",null,b(p.title),1),l("h3",null,b(p.subtitle),1),ue(e.$slots,"activity")]),ue(e.$slots,"sidebar")],64))}}),Q={props:["sentences","wordMap","selectedWordIndex","selectedSentenceIndex","highlighting","wordOptions"],emits:["selectWord"],setup(p,e){const t=n=>{if(p.wordMap===void 0)return"";let s=p.wordMap.get(n);if(!p.highlighting||!s.isDefined())return{backgroundColor:""};let r=(s.getMasteryPercentage()*120).toString(10);return{backgroundColor:"hsl("+r+",100%,75%)"}};return()=>{let n=0;if(p.sentences===void 0)return X("p");let s=p.sentences.map((r,i)=>{let u=r.getWordsAndSpaces().map(v=>{if(v.trim()==="")return v;let _=A.cleanWord(v);if(_==="")return v;let D=n;n+=1;let f=p.selectedWordIndex===D,x={selected:f},h=v;if(p.wordOptions){const g=p.wordOptions(v,_);g.bold&&(x.bold=!0),g.blank&&(h="__________")}let d={key:D,style:f?"":t(_),class:x,onClick(){e.emit("selectWord",D)}};return X("span",d,h)});const T={selected:p.selectedSentenceIndex===i};return X("span",{key:i,class:T},u)});return X("p",{className:p.highlighting?"highlight":""},s)}}},it={id:"props.id"},fe={props:["tag","text","focus","definition","language"],emits:["next","definitionUpdate"],setup(p,{emit:e}){const t=p,n=q(()=>t.tag?t.tag:"input"),s=Z(null),r=Z(t.definition),i=u=>{u.key==="Tab"&&(u.preventDefault(),u.target.blur(),e("next")),u.stopPropagation()},o=()=>{const u=t.text,T="https://translate.googleapis.com/translate_a/single?client=gtx&sl="+t.language+"&tl=en&dt=t&q="+encodeURI(u);fetch(T).then(v=>v.json()).then(v=>{r.value=v[0].map(([_])=>_).join(""),s.value.focus()})};return V(()=>{t.focus&&s.value.focus()}),(u,T)=>(y(),M("div",it,[l("span",null,b(t.text),1),(y(),L(Ae(a(n)),{ref_key:"definitionInput",ref:s,type:"text",placeholder:"Definition",value:r.value,onInput:T[0]||(T[0]=v=>r.value=v.target.value),onBlur:T[1]||(T[1]=v=>e("definitionUpdate",t.text,r.value)),onKeydown:i},null,8,["value"])),l("button",{onClick:o},"Google Translate")]))}};class at{constructor(e){c(this,"wordIndex");c(this,"text");this.text=e,this.wordIndex=void 0}nextSentence(){if(this.wordIndex===void 0)return;const e=this.text().sentenceIndexByWordIndex,t=e[this.wordIndex];for(;;)if(this.wordIndex===this.text().words.length-1||(this.wordIndex+=1,e[this.wordIndex]!==t))return}nextWord(){this.wordIndex!==void 0&&this.wordIndex!==this.text().words.length-1&&(this.wordIndex+=1)}selectedWord(){return this.wordIndex===void 0?{}:this.text().words[this.wordIndex]}selectedSentence(){if(this.wordIndex===void 0)return{};const e=this.text().sentenceIndexByWordIndex[this.wordIndex],t=this.text().sentences[e].clean;return this.text().sentenceMap.get(t)}setIndex(e){this.wordIndex=e}getIndex(){return this.wordIndex}}const ot={class:"sidebar right"},dt={class:"sidebar-group"},lt={class:"sidebar-group"},ct={class:"sidebar-group"},ut={props:["languageText","runtimeData"],emits:["changePageBy"],setup(p,{emit:e}){const t=p,n=P(),s=k({selectedWordCursor:new at(()=>t.languageText),highlighting:!1,page:t.runtimeData.currentPage,marker:void 0}),r=q(()=>s.selectedWordCursor.selectedWord()),i=q(()=>s.selectedWordCursor.selectedSentence()),o=(...f)=>t.languageText.updateWordDefinition(...f),u=(...f)=>t.languageText.updateSentenceDefinition(...f),T=()=>{const f=t.languageText.sentences,x=t.languageText.sentenceMap;if(f.length===0)return;const h=f[0].clean,d=f[f.length-1].clean,g=x.get(h).startTime,m=x.get(d).endTime;n.setAudioTimes(g,m),n.pause()},v=()=>{t.runtimeData.currentPage!==s.page&&(s.selectedWordCursor.setIndex(void 0),s.page=t.runtimeData.currentPage)},_=()=>{s.marker===void 0?(n.play(),s.marker=0):s.marker+=1;let f=t.languageText.sentences;if(s.marker>0){let d=f[s.marker-1],g=t.languageText.sentenceMap.get(d.clean);t.languageText.updateSentenceTimes(g,null,n.getCurrentTime())}if(s.marker===f.length){n.pause(),s.marker=void 0;return}let x=f[s.marker],h=t.languageText.sentenceMap.get(x.clean);t.languageText.updateSentenceTimes(h,n.getCurrentTime(),null)},D=f=>{f.target instanceof HTMLInputElement||f.target instanceof HTMLTextAreaElement||f.key==="m"&&_()};return V(()=>{document.addEventListener("keydown",D)}),z(()=>{document.removeEventListener("keydown",D)}),U(()=>{v(),T()}),R(()=>{T()}),(f,x)=>(y(),L(B,{title:"Reader",subtitle:"Page "+(t.runtimeData.currentPage+1)},{activity:N(()=>[(y(),L(Q,{sentences:t.languageText.sentences,"word-map":t.languageText.wordMap,key:t.runtimeData.currentPage,"selected-word-index":a(s).selectedWordCursor.getIndex(),"selected-sentence-index":a(s).marker,highlighting:a(s).highlighting,onSelectWord:x[0]||(x[0]=h=>a(s).selectedWordCursor.setIndex(h))},null,8,["sentences","word-map","selected-word-index","selected-sentence-index","highlighting"]))]),sidebar:N(()=>[l("div",ot,[l("div",dt,[(y(),L(fe,{id:"word-definition",key:a(r).word,text:a(r).word,focus:a(s).selectedWordCursor.getIndex()!==void 0,definition:a(r).definition,language:t.runtimeData.language,onDefinitionUpdate:o,onNext:x[1]||(x[1]=h=>a(s).selectedWordCursor.nextWord())},null,8,["text","focus","definition","language"])),(y(),L(fe,{tag:"textarea",id:"sentence-definition",key:a(i).sentence,text:a(i).sentence,definition:a(i).definition,language:t.runtimeData.language,onDefinitionUpdate:u,onNext:x[2]||(x[2]=h=>a(s).selectedWordCursor.nextSentence())},null,8,["text","definition","language"]))]),l("div",lt,[l("button",{onClick:x[3]||(x[3]=h=>e("changePageBy",-1))},"Previous Page"),l("button",{onClick:x[4]||(x[4]=h=>e("changePageBy",1))},"Next Page")]),l("div",ct,[l("button",{onClick:x[5]||(x[5]=h=>a(s).highlighting=!a(s).highlighting)}," Toggle Highlighting ")])])]),_:1},8,["subtitle"]))}},oe={props:["sentence"],setup(p){const e=p,t=P(),n=G(),s=k({startTime:e.sentence.startTime,endTime:e.sentence.endTime});me(e,()=>{s.startTime=e.sentence.startTime,s.endTime=e.sentence.endTime});const r=o=>{if(o!=="")return Number.parseFloat(o)},i=()=>{let o=r(s.startTime),u=r(s.endTime);e.sentence.updateTimes(o,u),t.setAudioTimes(o,u),n.putSentence(ie(e.sentence))};return(o,u)=>(y(),M(J,null,[pe(l("input",{ref:"definitionInput",type:"number",placeholder:"Start Time","onUpdate:modelValue":u[0]||(u[0]=T=>a(s).startTime=T),onBlur:i},null,544),[[ge,a(s).startTime]]),pe(l("input",{ref:"definitionInput",type:"number",placeholder:"End Time","onUpdate:modelValue":u[1]||(u[1]=T=>a(s).endTime=T),onBlur:i},null,544),[[ge,a(s).endTime]])],64))}},pt=["onClick"],ee={props:["pool","solution"],emits:["correctAnswer"],setup(p,{emit:e}){const t=p;let n;const s=i=>{i===t.solution&&e("correctAnswer")},r=q(()=>{const i=[t.solution];for(let o=0;o<20;o+=1){let u=A.randomItem(t.pool);if(i.indexOf(u)===-1&&i.push(u),i.length===4)break}return A.shuffle(i),i});return V(()=>{n=i=>{if(!(i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement)&&["1","2","3","4"].indexOf(i.key)!==-1){i.preventDefault();let u=Number.parseInt(i.key)-1;s(r.value[u])}},document.addEventListener("keydown",n)}),z(()=>{document.removeEventListener("keydown",n)}),(i,o)=>(y(),M("div",null,[(y(!0),M(J,null,ye(a(r),(u,T)=>(y(),M("button",{key:"index",class:"multiple-choice",onClick:v=>s(u)},b(`${T+1}. ${u}`),9,pt))),128))]))}};class ve{constructor(e,t,n=void 0){c(this,"raw");c(this,"clean");c(this,"sentenceId");this.raw=e,this.clean=t,this.sentenceId=n}getWords(){return this.clean.split(/\s+/).map(A.cleanWord).filter(e=>e!=="")}getWordsAndSpaces(){return this.raw.split(/(\s+)/)}}const gt=K(),F=G(),se=ae();class te{constructor(e,t){c(this,"masteryLevel");c(this,"practiceWords");c(this,"wordIndex");c(this,"sentences");c(this,"wordPool");c(this,"sentencePool");c(this,"done");this.masteryLevel=e,this.practiceWords=[],this.wordIndex=0,this.sentences=new Map,this.wordPool=[],this.sentencePool=[],this.done=t}word(){return this.practiceWords[this.wordIndex]}sentence(){const e=this.word();if(e!==void 0)return this.sentences.get(e.sentenceId)}rawSentences(){const e=this.sentence();return e===void 0?[]:[new ve(e.sentence,e.sentence,e.id)]}correctAnswer(){const e=this.word();e.updateMastery(this.masteryLevel),F.putWords([ie(e)]),se.learnedToday+=1/E.MASTERY_LEVEL_COUNT,se.masteredToday+=e.isMastered()?1:0,F.putRuntimeData(se),gt.decrement(this.masteryLevel),this.wordIndex+=1,this.wordIndex===this.practiceWords.length&&this.done()}async load(){const e=await F.getPracticeByType(this.masteryLevel),t=await F.getSentencesForWords(e),n=await F.getAllWords(),s=(await F.getDefinedSentences()).map(r=>r.definition);this.practiceWords=e,this.sentences=t,this.wordPool=n,this.sentencePool=s}}const ht={class:"sidebar right"},ft={class:"sidebar-group"},mt={emits:["done"],setup(p,{emit:e}){const t=P(),n=k(new te(E.MASTERY_LEVELS.VOCAB_IN_CONTEXT,()=>e("done"))),s=(i,o)=>o===n.word().word?{bold:!0}:{},r=()=>n.wordPool.filter(i=>i.isDefined()).map(i=>i.definition);return R(()=>{n.load()}),U(()=>{const i=n.sentence();t.setAudioTimes(i.startTime,i.endTime),t.play()}),(i,o)=>a(n).word()?(y(),L(B,{key:0,title:a(w).VOCAB_IN_CONTEXT},{activity:N(()=>[C(Q,{sentences:a(n).rawSentences(),"word-options":s},null,8,["sentences"]),C(ee,{pool:r(),solution:a(n).word().definition,onCorrectAnswer:o[0]||(o[0]=()=>a(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:N(()=>[l("div",ht,[l("div",ft,[C(oe,{sentence:a(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):I("",!0)}},yt={emits:["done"],setup(p,{emit:e}){const t=G(),n=ae(),s=K(),r=k({practiceWords:[],practiceIndex:0,words:[],grid:[]});R(async()=>{r.practiceWords=await t.getPracticeByType(E.MASTERY_LEVELS.VOCAB_MATCHING),f()}),V(()=>{document.addEventListener("keydown",h)}),z(()=>{document.removeEventListener("keydown",h)});const i=(d,g)=>r.grid[g][d],o=(d,g,m)=>{r.grid[g][d]=m},u=(d,g)=>{const m=i(d,g);return{"matching-item":!0,selected:m===void 0?!1:m.selected}},T=(d,g)=>{const m=i(d,g);return m===void 0?"":r.words[m.wordIndex].definition},v=d=>{for(let g=0;g<r.words.length;g++)for(let m=0;m<r.words.length;m++){const S=i(m,g);if(S&&d(S))return[m,g]}},_=()=>{const[d,g]=v(H=>H.selected),m=i(d,g),S=(m.shuffledIndex+1)%r.words.length,[$,O]=v(H=>H.shuffledIndex===S),le=i($,O);m.selected=!1,le.selected=!0},D=(d,g)=>{const[m,S]=v(j=>j.selected),$=m+d,O=S+g;if(!(1<=$&&$<=2&&0<=O&&O<=r.words.length-1))return;const H=i($,O);o($,O,i(m,S)),o(m,S,H),x()&&(r.words.forEach(j=>{j.updateMastery(E.MASTERY_LEVELS.VOCAB_MATCHING),n.learnedToday+=1/E.MASTERY_LEVEL_COUNT,n.masteredToday+=j.isMastered()?1:0,s.decrement(E.MASTERY_LEVELS.VOCAB_MATCHING)}),t.putWords(r.words.map(ie)),t.putRuntimeData(n),f())},f=()=>{r.words=r.practiceWords.slice(r.practiceIndex,r.practiceIndex+8),r.words.length===0&&e("done");const d=r.words.map((g,m)=>m);A.shuffle(d),r.grid=d.map((g,m)=>[void 0,void 0,{wordIndex:g,shuffledIndex:m,selected:m===0}]),r.practiceIndex+=r.words.length},x=()=>{for(let d=0;d<r.words.length;d++){const g=i(1,d);if(g===void 0||g.wordIndex!==d)return!1}return!0},h=d=>{d.key==="Tab"&&(d.preventDefault(),_()),d.key==="ArrowDown"&&(d.preventDefault(),D(0,1)),d.key==="ArrowLeft"&&(d.preventDefault(),D(-1,0)),d.key==="ArrowUp"&&(d.preventDefault(),D(0,-1)),d.key==="ArrowRight"&&(d.preventDefault(),D(1,0)),d.stopPropagation()};return(d,g)=>a(r).practiceWords.length>0?(y(),L(B,{key:0,title:a(w).VOCAB_IN_CONTEXT},{activity:N(()=>[l("table",null,[(y(!0),M(J,null,ye(a(r).words,(m,S)=>(y(),M("tr",null,[l("td",{class:ne(u(0,S))},b(m.word),3),l("td",{class:ne(u(1,S))},b(T(1,S)),3),l("td",{class:ne(u(2,S))},b(T(2,S)),3)]))),256))])]),_:1},8,["title"])):I("",!0)}},wt={emits:["done"],setup(p,{emit:e}){const t=k(new te(E.MASTERY_LEVELS.CLOZE,()=>e("done"))),n=(r,i)=>i===t.word().word?{blank:!0}:{},s=()=>t.wordPool.map(r=>r.word);return R(()=>{t.load()}),(r,i)=>a(t).word()?(y(),L(B,{key:0,title:a(w).CLOZE},{activity:N(()=>[C(Q,{sentences:a(t).rawSentences(),"word-options":n},null,8,["sentences"]),C(ee,{pool:s(),solution:a(t).word().word,onCorrectAnswer:i[0]||(i[0]=()=>a(t).correctAnswer())},null,8,["pool","solution"])]),_:1},8,["title"])):I("",!0)}},Tt={class:"sidebar right"},vt={class:"sidebar-group"},xt={emits:["done"],setup(p,{emit:e}){const t=P(),n=k(new te(E.MASTERY_LEVELS.LISTENING1,()=>e("done"))),s=(i,o)=>o===n.word().word?{blank:!0}:{},r=()=>n.wordPool.map(i=>i.word);return R(()=>{n.load()}),U(()=>{const i=n.sentence();t.setAudioTimes(i.startTime,i.endTime),t.play()}),(i,o)=>a(n).word()?(y(),L(B,{key:0,title:a(w).LISTENING1},{activity:N(()=>[C(Q,{sentences:a(n).rawSentences(),"word-options":s},null,8,["sentences"]),C(ee,{pool:r(),solution:a(n).word().word,onCorrectAnswer:o[0]||(o[0]=()=>a(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:N(()=>[l("div",Tt,[l("div",vt,[C(oe,{sentence:a(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):I("",!0)}},Et={class:"sidebar right"},bt={class:"sidebar-group"},Lt={emits:["done"],setup(p,{emit:e}){const t=P(),n=k(new te(E.MASTERY_LEVELS.LISTENING2,()=>e("done")));return R(()=>{n.load()}),U(()=>{const s=n.sentence();t.setAudioTimes(s.startTime,s.endTime),t.play()}),(s,r)=>a(n).sentence()?(y(),L(B,{key:0,title:a(w).LISTENING2},{activity:N(()=>[C(ee,{pool:a(n).sentencePool,solution:a(n).sentence().definition,onCorrectAnswer:r[0]||(r[0]=()=>a(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:N(()=>[l("div",Et,[l("div",bt,[C(oe,{sentence:a(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):I("",!0)}};class Dt{constructor(e,t,n,s,r){c(this,"filename");c(this,"totalWordsTranslated");c(this,"db");c(this,"pages");c(this,"text");c(this,"sentences");c(this,"sentenceMap");c(this,"sentenceIndexByWordIndex");c(this,"words");c(this,"wordMap");c(this,"promise");c(this,"onNewWordLearned");this.db=e,this.filename=t,this.totalWordsTranslated=0,this.pages=this.extractPages(n),this.onNewWordLearned=r,this.sentences=[],this.sentenceMap=new Map,this.words=[],this.wordMap=new Map,this.sentenceIndexByWordIndex=[],this.promise=new Promise(i=>i()),this.setPage(s)}async load(){await this.loadSentences(),await this.loadWords()}onUpdateDefinition(e){}setPage(e){return e<0||e>=this.pages.length?!1:(this.text=this.pages[e],!0)}extractPages(e){const n=[];let s=0,r=0,i=0,o=0;for(;o++,o!==1e3;){if(i=e.indexOf(`
`,r+1),i===-1){n.push(e.substring(s));break}if(i-s>1e3){const u=Math.abs(r-s-1e3),T=Math.abs(i-s-1e3),v=u<T?r:i;n.push(e.substring(s,v)),s=v}r=i}return n}async loadWords(){this.wordMap=new Map,this.words=[],this.sentenceIndexByWordIndex=[];let e=0;for(const t of this.sentences){const n=t.getWords();for(const s of n){let r=this.wordMap.get(s);r===void 0&&(r=await this.db.getWord(s)),r===void 0&&(r=new E(s,t.sentenceId)),r.sentenceId===void 0&&(r.sentenceId=t.sentenceId),this.words.push(r),this.wordMap.set(s,r),this.sentenceIndexByWordIndex.push(e)}await this.db.putWords([...this.wordMap.values()]),e+=1}}updateWordDefinition(e,t){const n=this.wordMap.get(e);n!==void 0&&n.definition!==t&&(n.isDefined()||(this.totalWordsTranslated+=1,this.onNewWordLearned()),n.setDefinition(t),console.log("Updating definition... for "+e+" to "+t),this.db.putWords([n]),this.onUpdateDefinition(e))}updateSentenceDefinition(e,t){const n=this.sentenceMap.get(e);n!==void 0&&n.definition!==t&&(n.definition=t,console.log("Updating definition... for "+e+" to "+t),this.db.putSentence(n))}updateMastery(e){e=e.map(t=>this.words.get(t).nextMastery()),this.db.putWords(e)}async loadSentences(){let e=0;for(this.sentences=[],this.sentenceMap=new Map,this.text===void 0&&(this.text="");;){const t=A.nextEndPos(this.text,e),n=this.text.substring(e,t===!1?void 0:t+1);if(n==="")break;const s=n.trim();if(this.sentences.push(new ve(n,s)),t===!1)break;e=t+1}for(const t of this.sentences){if(this.sentenceMap.has(t.clean))continue;let n=await this.db.getSentence(t.clean);n===void 0&&(n=new we(t.clean),n.id=await this.db.putSentence(n)),this.sentenceMap.set(t.clean,n),t.sentenceId=n.id}}updateSentenceTimes(e,t,n){t!==null&&(e.startTime=t),n!==null&&(e.endTime=n),this.db.putSentence(e)}updateSentence(e){this.sentenceMap.set(e.sentence,e),this.db.putSentence(e)}getWordMap(e){const t=new Map;return e.forEach(n=>{t.set(n,this.words.get(n))}),t}getWordStrArray(){return Array.from(this.words).map(e=>e[1].word)}getSentenceDefinitionArray(){return Array.from(this.sentenceMap).map(e=>e[1].definition)}getDefinitionArray(){return Array.from(this.words).map(e=>e[1].definition)}leastMasteredWord(e){const t=this.getWordMap(e.getWords());return A.randomWordsByMastery(t,1)[0]}leastMastery(){let e=E.MAX_MASTERY;return Array.from(this.words).forEach(([t,n])=>{n.definition!==""&&n.mastery<e&&(e=n.mastery)}),e}}const St={setup(p){const e=G(),t=_e(void 0),n=P(),s=K(),r=ae(),i=k({runtimeData:r,activity:w.READER}),o=async()=>{if(r.load(await e.getRuntimeData()),i.runtimeData=r,r.isNewDay()){const h=await e.getStatistics(r.date);await e.putHistoryDay(h),i.runtimeData.updateForNewDay()}if(s.setCounts(await e.getMasteryCounts()),console.log(i.runtimeData),i.runtimeData.openTextFile){const h=await e.getTextFile();t.value=await u(h)}if(i.runtimeData.openAudioFile){let h=await e.getAudioFile();n.src=URL.createObjectURL(h)}},u=async h=>{let d=new Dt(e,i.runtimeData.openTextFile,h,i.runtimeData.currentPage,T);return await d.load(),d},T=()=>{r.definedToday+=1,r.learnedToday+=1/E.MASTERY_LEVEL_COUNT,s.incrementAll(),e.putRuntimeData(r)},v=async()=>{const h=await A.openFiles(),d=h.text,g=h.audio;if(d){const m=await d.text();i.runtimeData.openNewTextFile(d.name),t.value=await u(m),e.putTextFile(m)}g&&(i.runtimeData.openNewAudioFile(g.name),n.src=URL.createObjectURL(g),e.putAudioFile(g)),e.putRuntimeData(r)},_=async h=>{let d=i.runtimeData.currentPage+h;!t.value.setPage(d)||(await t.value.load(),i.runtimeData.currentPage=d,e.putRuntimeData(r))},D=h=>{i.runtimeData.language=h,e.putRuntimeData(r)},f=async()=>{const d=await(await A.uploadText()).text();await e.import(JSON.parse(d)),await o()},x=async()=>{let h=await e.export();A.download("language-db.json",JSON.stringify(h))};return V(o),(h,d)=>(y(),M("div",null,[C(st,{"runtime-data":a(i).runtimeData,onOpenFiles:v,onUpdateLanguage:D,onImportDatabase:f,onExportDatabase:x,onChangeActivity:d[0]||(d[0]=g=>a(i).activity=g)},null,8,["runtime-data"]),a(i).activity===a(w).READER&&a(t)?(y(),L(ut,{key:0,"runtime-data":a(i).runtimeData,"language-text":a(t),onChangePageBy:_},null,8,["runtime-data","language-text"])):I("",!0),a(i).activity===a(w).VOCAB_IN_CONTEXT?(y(),L(mt,{key:1,onDone:d[1]||(d[1]=g=>a(i).activity=a(w).READER)})):I("",!0),a(i).activity===a(w).VOCAB_MATCHING?(y(),L(yt,{key:2,onDone:d[2]||(d[2]=g=>a(i).activity=a(w).READER)})):I("",!0),a(i).activity===a(w).CLOZE?(y(),L(wt,{key:3,onDone:d[3]||(d[3]=g=>a(i).activity=a(w).READER)})):I("",!0),a(i).activity===a(w).LISTENING1?(y(),L(xt,{key:4,onDone:d[4]||(d[4]=g=>a(i).activity=a(w).READER)})):I("",!0),a(i).activity===a(w).LISTENING2?(y(),L(Lt,{key:5,onDone:d[5]||(d[5]=g=>a(i).activity=a(w).READER)})):I("",!0)]))}},At=Ie({history:Me("/language-reader-vue/"),routes:[{path:"/",name:"main",component:St}]}),de=Ce(We);de.use(ke());de.use(At);de.mount("#app");
