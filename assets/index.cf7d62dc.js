var fe=Object.defineProperty;var he=(u,e,t)=>e in u?fe(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var c=(u,e,t)=>(he(u,typeof e!="symbol"?e+"":e,t),t);import{d as ee,o as T,c as E,u as o,R as me,r as k,a as Q,b as R,e as U,w as le,f as _,g as G,h,t as A,i as S,j as oe,F as j,k as Y,l as H,m as we,n as O,p as C,D as ye,q as ae,v as de,s as te,x as ue,y as M,z as K,A as Te,B as xe,C as ve,E as be,G as Ee}from"./vendor.55905bae.js";const Le=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}};Le();const De=ee({setup(u){return(e,t)=>(T(),E(o(me)))}});class Ae{constructor(){c(this,"src");c(this,"startTime");c(this,"endTime");c(this,"paused",!0)}setAudioTimes(e,t){return this.startTime=e,this.endTime=t,this}play(){return this.paused=!1,this}pause(){return this.paused=!0,this}getCurrentTime(){}}const Ie=k(new Ae),W=()=>Ie,Se=["src"],Me={setup(u){const e=Q(null),t=W();t.getCurrentTime=()=>e.value.currentTime;let n,r,i;const s=()=>{e.value.paused&&(e.value.play(),t.play(),a())},a=()=>{if(clearTimeout(i),r&&!e.value.paused){let m=r-e.value.currentTime;i=window.setTimeout(()=>{L(),g()},m*1e3)}},g=()=>{n&&(e.value.currentTime=n)},x=()=>{e.value.paused?s():L()},y=()=>{g(),a(),s()},L=()=>{e.value.paused||(e.value.pause(),t.pause(),a())},I=m=>{m.target instanceof HTMLInputElement||m.target instanceof HTMLTextAreaElement||(m.key==="p"?x():m.key==="r"&&y())};return R(()=>{document.addEventListener("keydown",I)}),U(()=>{document.removeEventListener("keydown",I)}),le(t,()=>{(n!==t.startTime||r!==t.endTime)&&(n=t.startTime,r=t.endTime,g(),a()),e.value.paused!==t.paused&&x()}),(m,d)=>(T(),_("audio",{controls:"",src:o(t).src,ref_key:"audio",ref:e},null,8,Se))}},P=class{constructor(e,t){c(this,"word");c(this,"definition");c(this,"mastery");c(this,"sentenceId");this.word=e,this.sentenceId=t,this.definition="",this.mastery=0}updateMastery(e){return this.mastery|=e,this}hasMastery(e){return this.mastery&e}isDefined(){return this.mastery&P.MASTERY_LEVELS.DEFINED}setDefinition(e){this.definition=e,this.updateMastery(P.MASTERY_LEVELS.DEFINED)}getMasteryPercentage(){let e=0;for(let t=1;t<=P.MASTERY_LEVELS.LISTENING2;t<<=1)t&this.mastery&&(e+=1);return e/Object.keys(P.MASTERY_LEVELS).length}getNewCount(){return this.isDefined()?1:0}};let v=P;c(v,"MASTERY_LEVELS",{DEFINED:1<<0,VOCAB_IN_CONTEXT:1<<1,VOCAB_MATCHING:1<<2,CLOZE:1<<3,LISTENING1:1<<4,LISTENING2:1<<5}),c(v,"FULL_MASTERY",63);class w{}c(w,"READER","Reader"),c(w,"VOCAB_IN_CONTEXT","Vocabulary in Context"),c(w,"VOCAB_MATCHING","Vocabulary Matching"),c(w,"CLOZE","Cloze"),c(w,"LISTENING1","Listening 1"),c(w,"LISTENING2","Listening 2");class _e{constructor(){c(this,"counts")}setCounts(e){this.counts=e}incrementAll(){Object.values(v.MASTERY_LEVELS).forEach(t=>{t!==v.MASTERY_LEVELS.DEFINED&&(this.counts[t]+=1)})}decrement(e){this.counts[e]-=1}getCount(e){return this.counts&&this.counts[e]}}const Ce=k(new _e),ne=()=>Ce,ke={class:"sidebar"},Ne={class:"sidebar-group"},We=["value"],Pe={class:"sidebar-group"},Re={class:"sidebar-group"},Oe=ee({props:["runtimeData","statistics"],emits:["updateLanguage","importDatabase","exportDatabase","openFiles","changeActivity"],setup(u,{emit:e}){const t=u,n=ne();G(()=>console.log("Sidebar will update",t));const r=i=>{const s=n.getCount(i);return s>0?`(${s})`:""};return(i,s)=>(T(),_("div",ke,[h("div",Ne,[h("h3",null,A(t.runtimeData.openTextFile),1),h("h4",null,A(t.runtimeData.openAudioFile),1),S(Me),h("button",{onClick:s[0]||(s[0]=a=>i.$emit("openFiles"))},"Open Files"),h("input",{value:t.runtimeData.language,onChange:s[1]||(s[1]=a=>e("updateLanguage",a.target.value)),placeholder:"Language",type:"text"},null,40,We)]),h("div",Pe,[h("button",{onClick:s[2]||(s[2]=a=>e("changeActivity",o(w).READER))}," Reader "),h("button",{onClick:s[3]||(s[3]=a=>e("changeActivity",o(w).VOCAB_IN_CONTEXT))}," Vocabulary in Context "+A(r(o(v).MASTERY_LEVELS.VOCAB_IN_CONTEXT)),1),h("button",{onClick:s[4]||(s[4]=a=>e("changeActivity",o(w).VOCAB_MATCHING))}," Vocabulary Matching "+A(r(o(v).MASTERY_LEVELS.VOCAB_MATCHING)),1),h("button",{onClick:s[5]||(s[5]=a=>e("changeActivity",o(w).CLOZE))}," Cloze "+A(r(o(v).MASTERY_LEVELS.CLOZE)),1),h("button",{onClick:s[6]||(s[6]=a=>e("changeActivity",o(w).LISTENING1))}," Listening 1 "+A(r(o(v).MASTERY_LEVELS.LISTENING1)),1),h("button",{onClick:s[7]||(s[7]=a=>e("changeActivity",o(w).LISTENING2))}," Listening 2 "+A(r(o(v).MASTERY_LEVELS.LISTENING2)),1)]),h("div",Re,[h("button",{onClick:s[8]||(s[8]=a=>e("exportDatabase"))},"Export Database"),h("button",{onClick:s[9]||(s[9]=a=>e("importDatabase"))},"Import Database")])]))}}),$e={id:"main"},$=ee({props:["title","subtitle"],setup(u){return(e,t)=>(T(),_(j,null,[h("div",$e,[h("h2",null,A(u.title),1),h("h3",null,A(u.subtitle),1),oe(e.$slots,"activity")]),oe(e.$slots,"sidebar")],64))}});class D{static randomWordsByMastery(e,t){const n=Array.from(e.values()).filter(a=>a.definition!=="");if(n.length<t)return[];const r=n.map(a=>a.mastery);let i=Math.min(...r),s=[];for(;s.length<t;){const a=n.filter(g=>g.mastery===i);D.shuffle(a),s=s.concat(a.slice(0,t-s.length)),i+=1}return s}static cleanWord(e){const t=e.match(/\p{Letter}+/u);return t?t[0].toLowerCase():""}static shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}static randomItem(e){const t=Math.floor(Math.random()*e.length);return e[t]}static createHTML(e){const[t,...n]=e,r=document.createElement(t);for(const i in n){const s=n[i];if(Array.isArray(s))r.append(this.createHTML(s));else if(typeof s=="string"||typeof s=="number"||s instanceof Element)r.append(s);else if(typeof s=="object")for(const a in s)r[a]=s[a]}return r}static isEndChar(e){return e==="..."?!1:e.match(/[.?!]/)!==null}static nextEndPos(e,t){for(;;){const n=e.substring(t,t+1);if(e.substring(t,t+3)==="..."){t+=3;continue}if(n==="")return!1;if(this.isEndChar(n))break;t+=1}for(;;){const n=e.substring(t+1,t+2);if(!this.isEndChar(n))break;t+=1}for(;e.substring(t+1,t+2).match(/[\sâ€œ]/)!==null;)t+=1;return t}static createDraggableItem(e){const t=document.createElement(e.tag);return t.id=e.id,t.classList.add("matching-item"),t.innerText=e.text,t.draggable=!0,t.addEventListener("drop",n=>{n.preventDefault();const r=document.getElementById(n.dataTransfer.getData("text/plain")),i=n.target;if(i.draggable===!1)return;const s=i.innerHTML;i.innerHTML=r.innerHTML,r.innerHTML=s,i.classList.remove("drag-over"),e.onDrop&&e.onDrop(r,i,e)}),t.addEventListener("dragenter",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragover",n=>{n.preventDefault(),n.target.draggable!==!1&&n.target.classList.add("drag-over")}),t.addEventListener("dragleave",n=>{n.target.classList.remove("drag-over")}),t.addEventListener("dragstart",n=>{n.dataTransfer.setData("text/plain",n.target.id)}),t}static benchmark(e){const t=new Date().getTime();e();const n=new Date().getTime();console.log((n-t)/1e3)}static download(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}static upload(){const e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("multiple",""),e.style.display="none",document.body.appendChild(e),new Promise(t=>{e.addEventListener("change",()=>{t(e.files||new FileList),e.remove()}),e.click()})}static async uploadText(){return(await D.upload())[0]}static async openFiles(){const e=await D.upload(),t={};for(let n=0;n<e.length;n++){const r=e[n];r.type==="text/plain"&&(t.text=r),(r.type==="audio/mpeg"||r.type==="audio/x-m4a")&&(t.audio=r)}return t}}const X={props:["sentences","wordMap","selectedWordIndex","selectedSentenceIndex","highlighting","wordOptions"],emits:["selectWord"],setup(u,e){const t=n=>{if(u.wordMap===void 0)return"";let r=u.wordMap.get(n);if(!u.highlighting||!r.isDefined())return{backgroundColor:""};let i=(r.getMasteryPercentage()*120).toString(10);return{backgroundColor:"hsl("+i+",100%,75%)"}};return()=>{let n=0;if(u.sentences===void 0)return Y("p");let r=u.sentences.map((i,s)=>{let g=i.getWordsAndSpaces().map(y=>{if(y.trim()==="")return y;let L=D.cleanWord(y);if(L==="")return y;let I=n;n+=1;let m=u.selectedWordIndex===I,d={selected:m},f=y;if(u.wordOptions){const p=u.wordOptions(y,L);p.bold&&(d.bold=!0),p.blank&&(f="__________")}let l={key:I,style:m?"":t(L),class:d,onClick(){e.emit("selectWord",I)}};return Y("span",l,f)});const x={selected:u.selectedSentenceIndex===s};return Y("span",{key:s,class:x},g)});return Y("p",{className:u.highlighting?"highlight":""},r)}}},Fe={id:"props.id"},ce={props:["tag","text","focus","definition","language"],emits:["next","definitionUpdate"],setup(u,{emit:e}){const t=u,n=H(()=>t.tag?t.tag:"input"),r=Q(null),i=Q(t.definition),s=g=>{g.key==="Tab"&&(g.preventDefault(),g.target.blur(),e("next")),g.stopPropagation()},a=()=>{const g=t.text,x="https://translate.googleapis.com/translate_a/single?client=gtx&sl="+t.language+"&tl=en&dt=t&q="+encodeURI(g);fetch(x).then(y=>y.json()).then(y=>{i.value=y[0].map(([L])=>L).join(""),r.value.focus()})};return R(()=>{t.focus&&r.value.focus()}),(g,x)=>(T(),_("div",Fe,[h("span",null,A(t.text),1),(T(),E(we(o(n)),{ref_key:"definitionInput",ref:r,type:"text",placeholder:"Definition",value:i.value,onInput:x[0]||(x[0]=y=>i.value=y.target.value),onBlur:x[1]||(x[1]=y=>e("definitionUpdate",t.text,i.value)),onKeydown:s},null,8,["value"])),h("button",{onClick:a},"Google Translate")]))}};class Be{constructor(e){c(this,"wordIndex");c(this,"text");this.text=e,this.wordIndex=void 0}nextSentence(){if(this.wordIndex===void 0)return;const e=this.text().sentenceIndexByWordIndex,t=e[this.wordIndex];for(;;)if(this.wordIndex===this.text().words.length-1||(this.wordIndex+=1,e[this.wordIndex]!==t))return}nextWord(){this.wordIndex!==void 0&&this.wordIndex!==this.text().words.length-1&&(this.wordIndex+=1)}selectedWord(){return this.wordIndex===void 0?{}:this.text().words[this.wordIndex]}selectedSentence(){if(this.wordIndex===void 0)return{};const e=this.text().sentenceIndexByWordIndex[this.wordIndex],t=this.text().sentences[e].clean;return this.text().sentenceMap.get(t)}setIndex(e){this.wordIndex=e}getIndex(){return this.wordIndex}}const Ve={class:"sidebar right"},Ge={class:"sidebar-group"},Ye={class:"sidebar-group"},He={class:"sidebar-group"},Ue={props:["languageText","runtimeData"],emits:["changePageBy"],setup(u,{emit:e}){const t=u,n=W(),r=k({selectedWordCursor:new Be(()=>t.languageText),highlighting:!1,page:t.runtimeData.currentPage,marker:void 0}),i=H(()=>r.selectedWordCursor.selectedWord()),s=H(()=>r.selectedWordCursor.selectedSentence()),a=(...m)=>t.languageText.updateWordDefinition(...m),g=(...m)=>t.languageText.updateSentenceDefinition(...m),x=()=>{const m=t.languageText.sentences,d=t.languageText.sentenceMap;if(m.length===0)return;const f=m[0].clean,l=m[m.length-1].clean,p=d.get(f).startTime,b=d.get(l).endTime;n.setAudioTimes(p,b),n.pause()},y=()=>{t.runtimeData.currentPage!==r.page&&(r.selectedWordCursor.setIndex(void 0),r.page=t.runtimeData.currentPage)},L=()=>{r.marker===void 0?(n.play(),r.marker=0):r.marker+=1;let m=t.languageText.sentences;if(r.marker>0){let l=m[r.marker-1],p=t.languageText.sentenceMap.get(l.clean);t.languageText.updateSentenceTimes(p,null,n.getCurrentTime())}if(r.marker===m.length){n.pause(),r.marker=void 0;return}let d=m[r.marker],f=t.languageText.sentenceMap.get(d.clean);t.languageText.updateSentenceTimes(f,n.getCurrentTime(),null)},I=m=>{m.target instanceof HTMLInputElement||m.target instanceof HTMLTextAreaElement||m.key==="m"&&L()};return R(()=>{document.addEventListener("keydown",I)}),U(()=>{document.removeEventListener("keydown",I)}),G(()=>{y(),x()}),O(()=>{x()}),(m,d)=>(T(),E($,{title:"Reader",subtitle:"Page "+(t.runtimeData.currentPage+1)},{activity:C(()=>[(T(),E(X,{sentences:t.languageText.sentences,"word-map":t.languageText.wordMap,key:t.runtimeData.currentPage,"selected-word-index":o(r).selectedWordCursor.getIndex(),"selected-sentence-index":o(r).marker,highlighting:o(r).highlighting,onSelectWord:d[0]||(d[0]=f=>o(r).selectedWordCursor.setIndex(f))},null,8,["sentences","word-map","selected-word-index","selected-sentence-index","highlighting"]))]),sidebar:C(()=>[h("div",Ve,[h("div",Ge,[(T(),E(ce,{id:"word-definition",key:o(i).word,text:o(i).word,focus:o(r).selectedWordCursor.getIndex()!==void 0,definition:o(i).definition,language:t.runtimeData.language,onDefinitionUpdate:a,onNext:d[1]||(d[1]=f=>o(r).selectedWordCursor.nextWord())},null,8,["text","focus","definition","language"])),(T(),E(ce,{tag:"textarea",id:"sentence-definition",key:o(s).sentence,text:o(s).sentence,definition:o(s).definition,language:t.runtimeData.language,onDefinitionUpdate:g,onNext:d[2]||(d[2]=f=>o(r).selectedWordCursor.nextSentence())},null,8,["text","definition","language"]))]),h("div",Ye,[h("button",{onClick:d[3]||(d[3]=f=>e("changePageBy",-1))},"Previous Page"),h("button",{onClick:d[4]||(d[4]=f=>e("changePageBy",1))},"Next Page")]),h("div",He,[h("button",{onClick:d[5]||(d[5]=f=>o(r).highlighting=!o(r).highlighting)}," Toggle Highlighting ")])])]),_:1},8,["subtitle"]))}};class V{constructor(){c(this,"currentPage");c(this,"xpToday");c(this,"xpLast");c(this,"xpDate");c(this,"openAudioFile");c(this,"openTextFile");c(this,"wordsLearnedToday");c(this,"language");this.xpToday=0,this.xpLast=0,this.xpDate=new Date().toLocaleDateString(),this.currentPage=0,this.wordsLearnedToday=0,this.language="es"}static fromObject(e){const t=new V;return Object.assign(t,e),t}updateForNewDay(){this.isNewDay()&&(this.xpLast=this.xpToday,this.xpToday=0,this.xpDate=new Date().toLocaleDateString(),this.wordsLearnedToday=0)}isNewDay(){return this.xpDate!==new Date().toLocaleDateString()}openNewTextFile(e){this.openTextFile=e,this.currentPage=0}openNewAudioFile(e){this.openAudioFile=e}}class pe{constructor(e,t=""){c(this,"id");c(this,"sentence");c(this,"definition");c(this,"mastery");c(this,"startTime");c(this,"endTime");this.sentence=e,this.definition=t,this.mastery=0}getRawWords(){return this.sentence.split(/\s+/).filter(e=>e!=="")}updateTimes(e,t){Number.isNaN(e)||(this.startTime=e),Number.isNaN(t)||(this.endTime=t)}}class je{constructor(){c(this,"db");this.db=new ye("LanguageDB"),this.db.version(2).stores({words:"word, mastery",sentences:"++id, sentence",other:"key"}),this.db.words.mapToClass(v),this.db.sentences.mapToClass(pe)}getWord(e){return this.db.words.get(e)}getSentence(e){return this.db.sentences.where("sentence").equals(e).first()}getSentenceById(e){return this.db.sentences.get(e)}getNumberOfWords(){return this.db.words.count()}putWords(e){return this.db.words.bulkPut(e)}putSentence(e){return console.log("Updating sentence",e),this.db.sentences.put(e)}async import(e){return await this.db.words.clear(),await this.db.sentences.clear(),await this.db.other.delete("runtimeData"),console.log("importing words"),await this.putWords(e.words),console.log("done importing words"),console.log("importing sentences"),await this.db.sentences.bulkPut(e.sentences),console.log("done importing sentences"),await this.db.other.put({key:"runtimeData",value:e.runtimeData}),console.log("done import"),"done"}async export(){const e=await this.db.words.toArray(),t=await this.db.sentences.toArray();return{runtimeData:await this.getRuntimeData(),sentences:t,words:e}}getRuntimeData(){return this.db.other.get("runtimeData").then(e=>e===void 0?new V:V.fromObject(e.value))}putRuntimeData(e){console.log("Saving runtime data",e),this.db.other.put({key:"runtimeData",value:e})}getTextFile(){return this.db.other.get("textFile").then(e=>e===void 0?void 0:e.value)}putTextFile(e){this.db.other.put({key:"textFile",value:e})}getAudioFile(){return this.db.other.get("audioFile").then(e=>e===void 0?void 0:e.value)}putAudioFile(e){this.db.other.put({key:"audioFile",value:e})}async getSentencesForWords(e){const t=await this.db.sentences.bulkGet(e.map(n=>n.sentenceId));return new Map(t.map(n=>[n.id,n]))}async getPracticeByType(e){const n=(await this.db.words.where("mastery").notEqual(v.FULL_MASTERY).toArray()).filter(r=>r.isDefined()&&!r.hasMastery(e));return D.shuffle(n),n}async getMasteryCounts(){const e=await this.db.words.where("mastery").notEqual(v.FULL_MASTERY).toArray(),t={},n=Object.values(v.MASTERY_LEVELS);return n.forEach(r=>{t[r]=0}),e.forEach(r=>{n.forEach(i=>{r.isDefined()&&!r.hasMastery(i)&&(t[i]+=1)})}),t}async getAllWords(){return await this.db.words.toArray()}async getDefinedSentences(){return(await this.db.sentences.toArray()).filter(e=>e.definition!=="")}}const Xe=new je,Z=()=>Xe,se={props:["sentence"],setup(u){const e=u,t=W(),n=Z(),r=k({startTime:e.sentence.startTime,endTime:e.sentence.endTime});le(e,()=>{r.startTime=e.sentence.startTime,r.endTime=e.sentence.endTime});const i=a=>{if(a!=="")return Number.parseFloat(a)},s=()=>{let a=i(r.startTime),g=i(r.endTime);e.sentence.updateTimes(a,g),t.setAudioTimes(a,g),n.putSentence(te(e.sentence))};return(a,g)=>(T(),_(j,null,[ae(h("input",{ref:"definitionInput",type:"number",placeholder:"Start Time","onUpdate:modelValue":g[0]||(g[0]=x=>o(r).startTime=x),onBlur:s},null,544),[[de,o(r).startTime]]),ae(h("input",{ref:"definitionInput",type:"number",placeholder:"End Time","onUpdate:modelValue":g[1]||(g[1]=x=>o(r).endTime=x),onBlur:s},null,544),[[de,o(r).endTime]])],64))}},Ze=["onClick"],q={props:["pool","solution"],emits:["correctAnswer"],setup(u,{emit:e}){const t=u;let n;const r=s=>{s===t.solution&&e("correctAnswer")},i=H(()=>{const s=[t.solution];for(let a=0;a<20;a+=1){let g=D.randomItem(t.pool);if(s.indexOf(g)===-1&&s.push(g),s.length===4)break}return D.shuffle(s),s});return R(()=>{n=s=>{if(!(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement)&&["1","2","3","4"].indexOf(s.key)!==-1){s.preventDefault();let g=Number.parseInt(s.key)-1;r(i.value[g])}},document.addEventListener("keydown",n)}),U(()=>{document.removeEventListener("keydown",n)}),(s,a)=>(T(),_("div",null,[(T(!0),_(j,null,ue(o(i),(g,x)=>(T(),_("button",{key:"index",class:"multiple-choice",onClick:y=>r(g)},A(`${x+1}. ${g}`),9,Ze))),128))]))}};class ge{constructor(e,t,n=void 0){c(this,"raw");c(this,"clean");c(this,"sentenceId");this.raw=e,this.clean=t,this.sentenceId=n}getWords(){return this.clean.split(/\s+/).map(D.cleanWord).filter(e=>e!=="")}getWordsAndSpaces(){return this.raw.split(/(\s+)/)}}const qe=ne(),B=Z();class z{constructor(e,t){c(this,"masteryLevel");c(this,"practiceWords");c(this,"wordIndex");c(this,"sentences");c(this,"wordPool");c(this,"sentencePool");c(this,"done");this.masteryLevel=e,this.practiceWords=[],this.wordIndex=0,this.sentences=new Map,this.wordPool=[],this.sentencePool=[],this.done=t}word(){return this.practiceWords[this.wordIndex]}sentence(){const e=this.word();if(e!==void 0)return this.sentences.get(e.sentenceId)}rawSentences(){const e=this.sentence();return e===void 0?[]:[new ge(e.sentence,e.sentence,e.id)]}correctAnswer(){const e=this.word();e.updateMastery(this.masteryLevel),B.putWords([te(e)]),qe.decrement(this.masteryLevel),this.wordIndex+=1,this.wordIndex===this.practiceWords.length&&this.done()}async load(){const e=await B.getPracticeByType(this.masteryLevel),t=await B.getSentencesForWords(e),n=await B.getAllWords(),r=(await B.getDefinedSentences()).map(i=>i.definition);this.practiceWords=e,this.sentences=t,this.wordPool=n,this.sentencePool=r}}const ze={class:"sidebar right"},Je={class:"sidebar-group"},Ke={emits:["done"],setup(u,{emit:e}){const t=W(),n=k(new z(v.MASTERY_LEVELS.VOCAB_IN_CONTEXT,()=>e("done"))),r=(s,a)=>a===n.word().word?{bold:!0}:{},i=()=>n.wordPool.filter(s=>s.isDefined()).map(s=>s.definition);return O(()=>{n.load()}),G(()=>{const s=n.sentence();t.setAudioTimes(s.startTime,s.endTime),t.play()}),(s,a)=>o(n).word()?(T(),E($,{key:0,title:o(w).VOCAB_IN_CONTEXT},{activity:C(()=>[S(X,{sentences:o(n).rawSentences(),"word-options":r},null,8,["sentences"]),S(q,{pool:i(),solution:o(n).word().definition,onCorrectAnswer:a[0]||(a[0]=()=>o(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:C(()=>[h("div",ze,[h("div",Je,[S(se,{sentence:o(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):M("",!0)}},Qe={emits:["done"],setup(u,{emit:e}){const t=Z(),n=k({practiceWords:[],practiceIndex:0,words:[],grid:[]});O(async()=>{n.practiceWords=await t.getPracticeByType(v.MASTERY_LEVELS.VOCAB_MATCHING),L()}),R(()=>{document.addEventListener("keydown",m)}),U(()=>{document.removeEventListener("keydown",m)});const r=(d,f)=>n.grid[f][d],i=(d,f,l)=>{n.grid[f][d]=l},s=(d,f)=>{const l=r(d,f);return{"matching-item":!0,selected:l===void 0?!1:l.selected}},a=(d,f)=>{const l=r(d,f);return l===void 0?"":n.words[l.wordIndex].definition},g=d=>{for(let f=0;f<n.words.length;f++)for(let l=0;l<n.words.length;l++){const p=r(l,f);if(p&&d(p))return[l,f]}},x=()=>{const[d,f]=g(F=>F.selected),l=r(d,f),p=(l.shuffledIndex+1)%n.words.length,[b,N]=g(F=>F.shuffledIndex===p),ie=r(b,N);l.selected=!1,ie.selected=!0},y=(d,f)=>{const[l,p]=g(J=>J.selected),b=l+d,N=p+f;if(!(1<=b&&b<=2&&0<=N&&N<=n.words.length-1))return;const F=r(b,N);i(b,N,r(l,p)),i(l,p,F),I()&&(n.words.forEach(J=>J.updateMastery(v.MASTERY_LEVELS.VOCAB_MATCHING)),t.putWords(n.words.map(te)),L())},L=()=>{n.words=n.practiceWords.slice(n.practiceIndex,n.practiceIndex+8),n.words.length===0&&e("done");const d=n.words.map((f,l)=>l);D.shuffle(d),n.grid=d.map((f,l)=>[void 0,void 0,{wordIndex:f,shuffledIndex:l,selected:l===0}]),n.practiceIndex+=n.words.length},I=()=>{for(let d=0;d<n.words.length;d++){const f=r(1,d);if(f===void 0||f.wordIndex!==d)return!1}return!0},m=d=>{d.key==="Tab"&&(d.preventDefault(),x()),d.key==="ArrowDown"&&(d.preventDefault(),y(0,1)),d.key==="ArrowLeft"&&(d.preventDefault(),y(-1,0)),d.key==="ArrowUp"&&(d.preventDefault(),y(0,-1)),d.key==="ArrowRight"&&(d.preventDefault(),y(1,0)),d.stopPropagation()};return(d,f)=>o(n).practiceWords.length>0?(T(),E($,{key:0,title:o(w).VOCAB_IN_CONTEXT},{activity:C(()=>[h("table",null,[(T(!0),_(j,null,ue(o(n).words,(l,p)=>(T(),_("tr",null,[h("td",{class:K(s(0,p))},A(l.word),3),h("td",{class:K(s(1,p))},A(a(1,p)),3),h("td",{class:K(s(2,p))},A(a(2,p)),3)]))),256))])]),_:1},8,["title"])):M("",!0)}},et={emits:["done"],setup(u,{emit:e}){const t=k(new z(v.MASTERY_LEVELS.CLOZE,()=>e("done"))),n=(i,s)=>s===t.word().word?{blank:!0}:{},r=()=>t.wordPool.map(i=>i.word);return O(()=>{t.load()}),(i,s)=>o(t).word()?(T(),E($,{key:0,title:o(w).CLOZE},{activity:C(()=>[S(X,{sentences:o(t).rawSentences(),"word-options":n},null,8,["sentences"]),S(q,{pool:r(),solution:o(t).word().word,onCorrectAnswer:s[0]||(s[0]=()=>o(t).correctAnswer())},null,8,["pool","solution"])]),_:1},8,["title"])):M("",!0)}},tt={class:"sidebar right"},nt={class:"sidebar-group"},st={emits:["done"],setup(u,{emit:e}){const t=W(),n=k(new z(v.MASTERY_LEVELS.LISTENING1,()=>e("done"))),r=(s,a)=>a===n.word().word?{blank:!0}:{},i=()=>n.wordPool.map(s=>s.word);return O(()=>{n.load()}),G(()=>{const s=n.sentence();t.setAudioTimes(s.startTime,s.endTime),t.play()}),(s,a)=>o(n).word()?(T(),E($,{key:0,title:o(w).LISTENING1},{activity:C(()=>[S(X,{sentences:o(n).rawSentences(),"word-options":r},null,8,["sentences"]),S(q,{pool:i(),solution:o(n).word().word,onCorrectAnswer:a[0]||(a[0]=()=>o(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:C(()=>[h("div",tt,[h("div",nt,[S(se,{sentence:o(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):M("",!0)}},rt={class:"sidebar right"},it={class:"sidebar-group"},ot={emits:["done"],setup(u,{emit:e}){const t=W(),n=k(new z(v.MASTERY_LEVELS.LISTENING2,()=>e("done")));return O(()=>{n.load()}),G(()=>{const r=n.sentence();t.setAudioTimes(r.startTime,r.endTime),t.play()}),(r,i)=>o(n).sentence()?(T(),E($,{key:0,title:o(w).LISTENING2},{activity:C(()=>[S(q,{pool:o(n).sentencePool,solution:o(n).sentence().definition,onCorrectAnswer:i[0]||(i[0]=()=>o(n).correctAnswer())},null,8,["pool","solution"])]),sidebar:C(()=>[h("div",rt,[h("div",it,[S(se,{sentence:o(n).sentence()},null,8,["sentence"])])])]),_:1},8,["title"])):M("",!0)}};class at{constructor(e,t,n,r,i){c(this,"filename");c(this,"totalWordsTranslated");c(this,"db");c(this,"pages");c(this,"text");c(this,"sentences");c(this,"sentenceMap");c(this,"sentenceIndexByWordIndex");c(this,"words");c(this,"wordMap");c(this,"promise");c(this,"onNewWordLearned");this.db=e,this.filename=t,this.totalWordsTranslated=0,this.pages=this.extractPages(n),this.onNewWordLearned=i,this.sentences=[],this.sentenceMap=new Map,this.words=[],this.wordMap=new Map,this.sentenceIndexByWordIndex=[],this.promise=new Promise(s=>s()),this.setPage(r)}async load(){await this.loadSentences(),await this.loadWords(),await this.loadTotalWordsTranslated()}onUpdateDefinition(e){}setPage(e){return e<0||e>=this.pages.length?!1:(this.text=this.pages[e],!0)}extractPages(e){const n=[];let r=0,i=0,s=0,a=0;for(;a++,a!==1e3;){if(s=e.indexOf(`
`,i+1),s===-1){n.push(e.substring(r));break}if(s-r>1e3){const g=Math.abs(i-r-1e3),x=Math.abs(s-r-1e3),y=g<x?i:s;n.push(e.substring(r,y)),r=y}i=s}return n}async loadWords(){this.wordMap=new Map,this.words=[],this.sentenceIndexByWordIndex=[];let e=0;for(const t of this.sentences){const n=t.getWords();for(const r of n){let i=this.wordMap.get(r);i===void 0&&(i=await this.db.getWord(r)),i===void 0&&(i=new v(r,t.sentenceId)),i.sentenceId===void 0&&(i.sentenceId=t.sentenceId),this.words.push(i),this.wordMap.set(r,i),this.sentenceIndexByWordIndex.push(e)}await this.db.putWords([...this.wordMap.values()]),e+=1}}async loadTotalWordsTranslated(){this.totalWordsTranslated=await this.db.getNumberOfWords()}updateWordDefinition(e,t){const n=this.wordMap.get(e);n!==void 0&&n.definition!==t&&(n.isDefined()||(this.totalWordsTranslated+=1,this.onNewWordLearned()),n.setDefinition(t),console.log("Updating definition... for "+e+" to "+t),this.db.putWords([n]),this.onUpdateDefinition(e))}updateSentenceDefinition(e,t){const n=this.sentenceMap.get(e);n!==void 0&&n.definition!==t&&(n.definition=t,console.log("Updating definition... for "+e+" to "+t),this.db.putSentence(n))}updateMastery(e){e=e.map(t=>this.words.get(t).nextMastery()),this.db.putWords(e)}updateStats(){let e=0,t=0;this.wordMap.forEach(i=>{e+=i.mastery,t+=i.getNewCount()});const n=0,r=e/(this.wordMap.size*5);return{newWords:t,totalWordsTranslated:this.totalWordsTranslated,percentTranslated:n,percentWordsMastered:r}}async loadSentences(){let e=0;for(this.sentences=[],this.sentenceMap=new Map,this.text===void 0&&(this.text="");;){const t=D.nextEndPos(this.text,e),n=this.text.substring(e,t===!1?void 0:t+1);if(n==="")break;const r=n.trim();if(this.sentences.push(new ge(n,r)),t===!1)break;e=t+1}for(const t of this.sentences){if(this.sentenceMap.has(t.clean))continue;let n=await this.db.getSentence(t.clean);n===void 0&&(n=new pe(t.clean),n.id=await this.db.putSentence(n)),this.sentenceMap.set(t.clean,n),t.sentenceId=n.id}}updateSentenceTimes(e,t,n){t!==null&&(e.startTime=t),n!==null&&(e.endTime=n),this.db.putSentence(e)}updateSentence(e){this.sentenceMap.set(e.sentence,e),this.db.putSentence(e)}getWordMap(e){const t=new Map;return e.forEach(n=>{t.set(n,this.words.get(n))}),t}getWordStrArray(){return Array.from(this.words).map(e=>e[1].word)}getSentenceDefinitionArray(){return Array.from(this.sentenceMap).map(e=>e[1].definition)}getDefinitionArray(){return Array.from(this.words).map(e=>e[1].definition)}leastMasteredWord(e){const t=this.getWordMap(e.getWords());return D.randomWordsByMastery(t,1)[0]}leastMastery(){let e=v.MAX_MASTERY;return Array.from(this.words).forEach(([t,n])=>{n.definition!==""&&n.mastery<e&&(e=n.mastery)}),e}}const dt={setup(u){const e=Z(),t=Te(void 0),n=W(),r=ne();let i=new V;const s=k({runtimeData:i,activity:w.READER}),a=async()=>{if(i=await e.getRuntimeData(),s.runtimeData=i,s.runtimeData.updateForNewDay(),r.setCounts(await e.getMasteryCounts()),console.log(s.runtimeData),s.runtimeData.openTextFile){const l=await e.getTextFile();t.value=await g(l),f()}if(s.runtimeData.openAudioFile){let l=await e.getAudioFile();n.src=URL.createObjectURL(l)}},g=async l=>{let p=new at(e,s.runtimeData.openTextFile,l,s.runtimeData.currentPage,x);return await p.load(),p},x=()=>{s.runtimeData.wordsLearnedToday+=1,s.runtimeData.xpToday+=1,r.incrementAll(),e.putRuntimeData(i)},y=async()=>{const l=await D.openFiles(),p=l.text,b=l.audio;if(p){const N=await p.text();s.runtimeData.openNewTextFile(p.name),t.value=await g(N),e.putTextFile(N),f()}b&&(s.runtimeData.openNewAudioFile(b.name),n.src=URL.createObjectURL(b),e.putAudioFile(b)),e.putRuntimeData(i)},L=async l=>{let p=s.runtimeData.currentPage+l;!t.value.setPage(p)||(await t.value.load(),s.runtimeData.currentPage=p,e.putRuntimeData(i))},I=l=>{s.runtimeData.language=l,e.putRuntimeData(i)},m=async()=>{const p=await(await D.uploadText()).text();await e.import(JSON.parse(p)),await a()},d=async()=>{let l=await e.export();D.download("language-db.json",JSON.stringify(l))},f=()=>{let l=t.value.updateStats();l.wordsLearnedToday=s.runtimeData.wordsLearnedToday,l.xpToday=s.runtimeData.xpToday,l.xpLast=s.runtimeData.xpLast,s.statistics=l};return R(a),(l,p)=>(T(),_("div",null,[S(Oe,{"runtime-data":o(s).runtimeData,statistics:o(s).statistics,onOpenFiles:y,onUpdateLanguage:I,onImportDatabase:m,onExportDatabase:d,onChangeActivity:p[0]||(p[0]=b=>o(s).activity=b)},null,8,["runtime-data","statistics"]),o(s).activity===o(w).READER&&o(t)?(T(),E(Ue,{key:0,"runtime-data":o(s).runtimeData,"language-text":o(t),onChangePageBy:L},null,8,["runtime-data","language-text"])):M("",!0),o(s).activity===o(w).VOCAB_IN_CONTEXT?(T(),E(Ke,{key:1,onDone:p[1]||(p[1]=b=>o(s).activity=o(w).READER)})):M("",!0),o(s).activity===o(w).VOCAB_MATCHING?(T(),E(Qe,{key:2,onDone:p[2]||(p[2]=b=>o(s).activity=o(w).READER)})):M("",!0),o(s).activity===o(w).CLOZE?(T(),E(et,{key:3,onDone:p[3]||(p[3]=b=>o(s).activity=o(w).READER)})):M("",!0),o(s).activity===o(w).LISTENING1?(T(),E(st,{key:4,onDone:p[4]||(p[4]=b=>o(s).activity=o(w).READER)})):M("",!0),o(s).activity===o(w).LISTENING2?(T(),E(ot,{key:5,onDone:p[5]||(p[5]=b=>o(s).activity=o(w).READER)})):M("",!0)]))}},ct=xe({history:ve("/language-reader-vue/"),routes:[{path:"/",name:"main",component:dt}]}),re=be(De);re.use(Ee());re.use(ct);re.mount("#app");
